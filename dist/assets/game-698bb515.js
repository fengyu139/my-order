import{K as ie,L as re,o as s,d,l as q,n as ue,e as n,m as de,aI as ce,r as _,U as ve,s as i,t as r,F as D,C as $,v as c,x as M,y as O,J as fe,D as _e,P as pe,A as p,ab as ge,ak as Pe,H as u,k as h,j as E,X as ye,Y as be,Z as me}from"./index-394e3bcc.js";/* empty css              */import{i as he}from"./index-787c68ed.js";import{_ as Me,a as ke}from"./index-9f16b64c.js";import{N as Se}from"./index-204e4d66.js";/* empty css              */import"./CheckNormal-4c869903.js";import"./pxCheck-OnXlN1NC-3938f682.js";import"./Plus-c98d7022.js";const Ve=re("close-little"),Ze=n("path",{d:"M998.002 26a85.073 85.073 0 0 0-120.415 0L451.795 451.792a85.073 85.073 0 1 0 120.414 120.415l425.793-425.793a85.073 85.073 0 0 0 0-120.414zM877.587 998a85.073 85.073 0 1 0 120.415-120.415L146.416 26A85.073 85.073 0 1 0 26.002 146.414L391.588 512 26.002 877.585A85.073 85.073 0 1 0 146.416 998l365.586-365.585 365.585 365.585z",fill:"currentColor","fill-opacity":"0.9"},null,-1),Ne=[Ze];function we(N,v,g,w,B,L){return s(),d("svg",{class:q(N.classes),style:ue(N.style),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1026 1024",role:"presentation"},Ne,6)}const Ce=ie(Ve,[["render",we]]),H=N=>(ye("data-v-a5d147a6"),N=N(),be(),N),Be={class:"game-container"},Fe={class:"header-buttons"},xe={class:"player-grid"},ze={class:"player-info"},Ie={class:"rank"},Ue={class:"game-info"},De={class:"score-section"},$e=H(()=>n("span",{class:"label"},"符子:",-1)),Te={class:"win-type"},Le={key:0,class:"fangpao-name"},Ee={class:"popup-header"},je=H(()=>n("div",{class:"result-header"},"计算结果",-1)),Ae={class:"close-icon"},Re={class:"result-list"},Oe={class:"result-header-row"},qe={class:"result-left"},He={class:"player-name"},Je={key:0,class:"result-tags"},Ke={class:"tag win-type-tag"},Xe={class:"tag score-tag"},Ye={class:"detail"},Ge={key:0},Qe={key:0,class:"detail-players"},We={key:1},ea={key:0,class:"detail-players"},aa={key:2},oa={key:0,class:"detail-players"},la={key:3},sa={key:0,class:"detail-players"},na=de({__name:"game",setup(N){const v=ce("initPlayer",[]),g=_([]);ve(()=>{g.value=v.value.map((a,o)=>(console.log(a.id,o),{index:o,id:"",score:0,name:"",fuZi:0,fangPao:"",fangPaoName:"",isZiMo:!0}))});const w=_(!1),B=_(""),L=_(!1),j=_(""),J=()=>{L.value=!1,j.value=""},K=()=>{w.value=!0,B.value=""},X=()=>{const a=Date.now();v.value.push({id:a,name:B.value.trim(),score:0}),w.value=!1},F=_(!1),b=_(),Y=()=>{if(v.value.length<=1){O.fail("至少保留一名玩家");return}F.value=!0,b.value=void 0},G=()=>{if(!b.value){O.fail("请选择要删除的玩家");return}const a=v.value.findIndex(o=>o.id===b.value);a!==-1&&(v.value.splice(a,1),F.value=!1)},Q=()=>{g.value=v.value.map((a,o)=>(console.log(a.id,o),{index:o,id:"",score:0,name:"",fuZi:0,fangPao:"",fangPaoName:"",isZiMo:!0}))},x=_(!1),z=_(),W=a=>{x.value=!0,z.value=g.value.findIndex(o=>o.id===a)},ee=()=>{if(!b.value||z.value===void 0)return;const a=v.value.find(o=>o.id===b.value);a&&z.value!==void 0&&(g.value[z.value]={...g.value[z.value],id:a.id,name:a.name}),x.value=!1,b.value=void 0},ae=a=>g.value.some(o=>o.id===a&&z.value!==g.value.findIndex(f=>f.id===a)),I=_(!1),C=_(),k=_(null),oe=a=>{k.value=a,I.value=!0,C.value=a.fangPao||void 0},le=()=>{if(!C.value||!k.value)return;const a=v.value.find(o=>o.id===C.value);a&&(k.value.fangPao=a.id,k.value.fangPaoName=a.name),I.value=!1,C.value=void 0,k.value=null},se=a=>{a.isZiMo?(a.fangPao="",a.fangPaoName=""):oe(a)},U=_(!1),S=_([]),ne=()=>{S.value=v.value.map(a=>({id:a.id,name:a.name,ziMoScore:0,beiFangPaoScore:0,beiFangPaoByPlayers:[],fangPaoScore:0,beiZiMoScore:0,ziMoPlayers:[],beiZiMoByPlayers:[],fangPaoToPlayers:[],total:0,order:-1,isZiMo:!1,score:0})),g.value.forEach((a,o)=>{if(!a.id||!a.score)return;const f=Number(a.score);if(isNaN(f))return;const V=S.value.find(t=>t.id===a.id);if(V&&(V.order=o,V.isZiMo=a.isZiMo,V.score=a.score),a.isZiMo){const t=S.value.find(P=>P.id===a.id);if(t){const P=v.value.filter(l=>l.id!==a.id&&!g.value.slice(0,o).some(m=>m.id===l.id)),y=f*2*P.length;t.ziMoScore+=y,t.total+=y,t.ziMoPlayers=P.map(l=>l.name),S.value.forEach(l=>{if(P.some(m=>m.id===l.id)){const m=f*2;l.beiZiMoScore-=m,l.total-=m,l.beiZiMoByPlayers||(l.beiZiMoByPlayers=[]),l.beiZiMoByPlayers.push(t.name)}})}}else if(!a.isZiMo&&a.fangPao){const t=Number(a.score),P=Number(a.fangPao);if(isNaN(P)||isNaN(t))return;const y=S.value.find(m=>m.id===a.id),l=S.value.find(m=>m.id===P);y&&l&&(y.beiFangPaoScore+=t,y.total+=t,y.beiFangPaoByPlayers||(y.beiFangPaoByPlayers=[]),y.beiFangPaoByPlayers.push(l.name)),l&&(l.fangPaoScore-=t,l.total-=t,l.fangPaoToPlayers||(l.fangPaoToPlayers=[]),y&&l.fangPaoToPlayers.push(y.name))}}),S.value.sort((a,o)=>a.order===-1&&o.order===-1?0:a.order===-1?1:o.order===-1?-1:a.order-o.order),U.value=!0},te=a=>{if(!k.value||a===k.value.id)return!0;const o=k.value.index;return g.value.some((f,V)=>V<o&&f.id===a&&f.id!=="")};return(a,o)=>{const f=fe,V=Se,t=Me,P=ke,y=he,l=_e,m=pe;return s(),d("div",Be,[n("div",Fe,[i(f,{type:"primary",onClick:K},{default:r(()=>[p("添加玩家")]),_:1}),i(f,{type:"danger",onClick:Y},{default:r(()=>[p("删除玩家")]),_:1}),i(f,{type:"danger",onClick:ne},{default:r(()=>[p("计算结果")]),_:1}),i(f,{type:"warning",onClick:Q},{default:r(()=>[p("重置数据")]),_:1})]),n("div",xe,[(s(!0),d(D,null,$(c(g),(e,T)=>ge((s(),d("div",{key:e.id,class:"player-item"},[n("div",ze,[n("span",Ie,"第"+u(e.index+1)+"名 ",1),i(f,{size:"small",onClick:Z=>W(e.id)},{default:r(()=>[p(u(e.name?e.name:"请选择"),1)]),_:2},1032,["onClick"])]),n("div",Ue,[n("div",De,[$e,i(V,{"button-size":30,"input-width":40,modelValue:e.score,"onUpdate:modelValue":Z=>e.score=Z,step:1,min:1,max:24},null,8,["modelValue","onUpdate:modelValue"])]),n("div",Te,[i(P,{modelValue:e.isZiMo,"onUpdate:modelValue":Z=>e.isZiMo=Z,onChange:Z=>se(e)},{default:r(()=>[i(t,{label:!0},{default:r(()=>[p("自摸")]),_:1}),i(t,{label:!1},{default:r(()=>[p("被放炮")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),e.isZiMo?h("",!0):(s(),d("span",Le,u(e.fangPaoName?`放炮: ${e.fangPaoName}`:"未选择放炮"),1))])])])),[[Pe,T<c(g).length-1]])),128))]),i(l,{visible:c(w),"onUpdate:visible":o[1]||(o[1]=e=>M(w)?w.value=e:null),title:"添加玩家",onOk:X,onCancel:o[2]||(o[2]=e=>w.value=!1),class:"custom-dialog"},{default:r(()=>[i(y,{modelValue:c(B),"onUpdate:modelValue":o[0]||(o[0]=e=>M(B)?B.value=e:null),placeholder:"请输入玩家名称",required:"",error:c(L),"error-message":c(j),onInput:J},null,8,["modelValue","error","error-message"])]),_:1},8,["visible"]),i(l,{visible:c(F),"onUpdate:visible":o[4]||(o[4]=e=>M(F)?F.value=e:null),title:"删除玩家",onOk:G,onCancel:o[5]||(o[5]=e=>F.value=!1),class:"custom-dialog"},{default:r(()=>[i(P,{modelValue:c(b),"onUpdate:modelValue":o[3]||(o[3]=e=>M(b)?b.value=e:null)},{default:r(()=>[(s(!0),d(D,null,$(c(v),e=>(s(),E(t,{key:e.id,label:e.id},{default:r(()=>[p(u(e.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["visible"]),i(l,{visible:c(x),"onUpdate:visible":o[7]||(o[7]=e=>M(x)?x.value=e:null),title:"选择玩家",footer:!1,onCancel:o[8]||(o[8]=e=>x.value=!1),class:"custom-dialog"},{default:r(()=>[i(P,{modelValue:c(b),"onUpdate:modelValue":o[6]||(o[6]=e=>M(b)?b.value=e:null),onChange:ee},{default:r(()=>[(s(!0),d(D,null,$(c(v),e=>(s(),E(t,{key:e.id,label:e.id,disabled:ae(e.id)},{default:r(()=>[p(u(e.name),1)]),_:2},1032,["label","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["visible"]),i(l,{visible:c(I),"onUpdate:visible":o[10]||(o[10]=e=>M(I)?I.value=e:null),title:"选择放炮玩家",footer:!1,onCancel:o[11]||(o[11]=e=>I.value=!1),class:"custom-dialog"},{default:r(()=>[i(P,{modelValue:c(C),"onUpdate:modelValue":o[9]||(o[9]=e=>M(C)?C.value=e:null),onChange:le},{default:r(()=>[(s(!0),d(D,null,$(c(v),e=>(s(),E(t,{key:e.id,label:e.id,disabled:te(e.id)},{default:r(()=>[p(u(e.name),1)]),_:2},1032,["label","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["visible"]),i(m,{visible:c(U),"onUpdate:visible":o[13]||(o[13]=e=>M(U)?U.value=e:null),position:"bottom",class:"result-popup"},{default:r(()=>[n("div",Ee,[je,n("div",Ae,[i(c(Ce),{onClick:o[12]||(o[12]=e=>U.value=!1)})])]),n("div",Re,[(s(!0),d(D,null,$(c(S),e=>{var T,Z,A,R;return s(),d("div",{key:e.id,class:"result-item"},[n("div",Oe,[n("div",qe,[n("span",He,u(e.name),1),n("span",{class:q(["score",e.total>=0?"win":"lose"])},u(e.total>=0?"+":"")+u(e.total),3)]),e.order>-1?(s(),d("div",Je,[n("span",Ke,u(e.isZiMo?"自摸":"被放炮"),1),n("span",Xe,u(e.score)+"符",1)])):h("",!0)]),n("div",Ye,[e.ziMoScore?(s(),d("div",Ge,[p(" 自摸得分：+"+u(e.ziMoScore)+" ",1),(T=e.ziMoPlayers)!=null&&T.length?(s(),d("span",Qe," ("+u(e.ziMoPlayers.join("、"))+") ",1)):h("",!0)])):h("",!0),e.beiFangPaoScore?(s(),d("div",We,[p(" 被放炮得分：+"+u(e.beiFangPaoScore)+" ",1),(Z=e.beiFangPaoByPlayers)!=null&&Z.length?(s(),d("span",ea," ("+u(e.beiFangPaoByPlayers.join("、"))+") ",1)):h("",!0)])):h("",!0),e.fangPaoScore?(s(),d("div",aa,[p(" 放炮失分："+u(e.fangPaoScore)+" ",1),(A=e.fangPaoToPlayers)!=null&&A.length?(s(),d("span",oa," ("+u(e.fangPaoToPlayers.join("、"))+") ",1)):h("",!0)])):h("",!0),e.beiZiMoScore?(s(),d("div",la,[p(" 被自摸失分："+u(e.beiZiMoScore)+" ",1),(R=e.beiZiMoByPlayers)!=null&&R.length?(s(),d("span",sa," ("+u(e.beiZiMoByPlayers.join("、"))+") ",1)):h("",!0)])):h("",!0)])])}),128))])]),_:1},8,["visible"])])}}});const pa=me(na,[["__scopeId","data-v-a5d147a6"]]);export{pa as default};
