import{K as Ke,L as Je,o as g,d as h,l as N,n as R,e as b,P as Xe,$ as Ge,a6 as qe,_ as $e,b as Se,ar as Qe,h as me,j as fe,t as C,H as E,k as P,f as Te,F as J,C as oe,N as Ze,i as Ee,r as w,c as X,as as et,at as tt,au as nt,av as ze,ad as st,m as ie,M as Oe,R as at,Z as Ne,a as ae,v as r,aw as ot,ae as it,af as lt,ax as rt,ay as ct,az as ut,w as dt,p as ge,aA as pt,s as x,ab as ve,ak as he,A as Y,aB as mt,x as _e,I as ft,z as gt,y as A,aC as vt,X as ht,Y as _t,a4 as ne,aD as yt,J as ye}from"./index-394e3bcc.js";import{i as bt}from"./index-787c68ed.js";/* empty css              */import{i as wt}from"./index-f84682f7.js";import{g as be,C as xt,i as kt,w as It,s as Ct}from"./index-63b96a95.js";import"./Checked-5a2ba363.js";import"./index-cp6Ms_Qe-3f5aade7.js";import"./index-084nl_oE-5e48f214.js";import"./raf-MQjoO-Ag-fe7281e5.js";const $t=Je("horizontal-n"),St=b("path",{d:"M977.455 124.121H46.545C21.721 124.121 0 102.4 0 77.576S21.721 31.03 46.545 31.03h930.91c24.824 0 46.545 21.722 46.545 46.546s-21.721 46.545-46.545 46.545zm0 868.849H46.545C21.721 992.97 0 971.248 0 946.424s21.721-46.545 46.545-46.545h930.91c24.824 0 46.545 21.721 46.545 46.545s-21.721 46.546-46.545 46.546zm0-434.425H356.848c-24.824 0-46.545-21.72-46.545-46.545s21.721-46.545 46.545-46.545h620.607c24.824 0 46.545 21.72 46.545 46.545s-21.721 46.545-46.545 46.545z",fill:"currentColor","fill-opacity":"0.9"},null,-1),Tt=[St];function Et(e,t,n,c,l,f){return g(),h("svg",{class:N(e.classes),style:R(e.style),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",role:"presentation"},Tt,6)}const zt=Ke($t,[["render",Et]]);var Ot=Object.defineProperty,Nt=Object.defineProperties,jt=Object.getOwnPropertyDescriptors,we=Object.getOwnPropertySymbols,Pt=Object.prototype.hasOwnProperty,Rt=Object.prototype.propertyIsEnumerable,xe=(e,t,n)=>t in e?Ot(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ft=(e,t)=>{for(var n in t||(t={}))Pt.call(t,n)&&xe(e,n,t[n]);if(we)for(var n of we(t))Rt.call(t,n)&&xe(e,n,t[n]);return e},Lt=(e,t)=>Nt(e,jt(t));const{create:Mt}=Se("action-sheet"),At=Mt({components:{NutPopup:Xe,Loading:Ge},props:Lt(Ft({},Qe),{cancelTxt:{type:String,default:""},optionTag:{type:String,default:"name"},optionSubTag:{type:String,default:"subname"},chooseTagValue:{type:String,default:""},title:{type:String,default:""},color:{type:String,default:"#ee0a24"},description:{type:String,default:""},menuItems:{type:Array,default:()=>[]},closeAbled:{type:Boolean,default:!0}}),emits:["cancel","close","choose","update:visible"],setup(e,{emit:t}){return{slotDefault:!!qe().default,isHighlight:i=>e.chooseTagValue&&e.chooseTagValue===i[e.optionTag]?e.color:"",cancelActionSheet:()=>{t("cancel"),t("update:visible",!1)},chooseItem:(i,u)=>{!i.disable&&!i.loading&&(t("choose",i,u),t("update:visible",!1))},close:i=>{e.closeAbled&&(t("close",i),t("update:visible",!1))}}}}),Dt={class:"nut-action-sheet"},Ht={key:0,class:"nut-action-sheet__title"},Bt={key:1},Vt={key:0,class:"nut-action-sheet__item nut-action-sheet__desc"},Ut={key:1,class:"nut-action-sheet__menu"},Wt=["onClick"],Yt={key:1},Kt={class:"nut-action-sheet__subdesc"};function Jt(e,t,n,c,l,f){const p=me("Loading"),i=me("nut-popup");return g(),fe(i,{visible:e.visible,position:"bottom",round:"","close-on-click-overlay":e.closeAbled,"lock-scroll":e.lockScroll,"z-index":e.zIndex,onClickOverlay:e.close},{default:C(()=>[b("view",Dt,[e.title?(g(),h("view",Ht,E(e.title),1)):P("",!0),Te(e.$slots,"default"),e.slotDefault?P("",!0):(g(),h("view",Bt,[e.description?(g(),h("view",Vt,E(e.description),1)):P("",!0),e.menuItems.length?(g(),h("view",Ut,[(g(!0),h(J,null,oe(e.menuItems,(u,o)=>(g(),h("view",{key:o,class:N(["nut-action-sheet__item",{"nut-action-sheet__item--disabled":u.disable,"nut-action-sheet__item--loading":u.loading}]),style:R({color:e.isHighlight(u)||u.color}),onClick:_=>e.chooseItem(u,o)},[u.loading?(g(),fe(p,{key:0})):(g(),h("view",Yt,E(u[e.optionTag]),1)),b("view",Kt,E(u[e.optionSubTag]),1)],14,Wt))),128))])):P("",!0),e.cancelTxt?(g(),h("view",{key:2,class:"nut-action-sheet__cancel",onClick:t[0]||(t[0]=(...u)=>e.cancelActionSheet&&e.cancelActionSheet(...u))},E(e.cancelTxt),1)):P("",!0)]))])]),_:3},8,["visible","close-on-click-overlay","lock-scroll","z-index","onClickOverlay"])}const Xt=$e(At,[["render",Jt]]),Gt=Symbol("nut-avatar"),{create:qt}=Se("avatar"),Qt=qt({props:{size:{type:[String,Number],default:"normal"},shape:{type:String,default:"round"},bgColor:{type:String,default:"#eee"},color:{type:String,default:"#666"}},setup(e){const{size:t,shape:n,bgColor:c,color:l}=Ze(e),f=["large","normal","small"],p=Ee(Gt,null),i=w(null),u=X(()=>{var _,y;return{["nut-avatar"]:!0,[`nut-avatar-${t.value||((_=p==null?void 0:p.props)==null?void 0:_.size)||"normal"}`]:!0,[`nut-avatar-${n.value||((y=p==null?void 0:p.props)==null?void 0:y.shape)||"round"}`]:!0}}),o=X(()=>{var _,y;return{width:t.value in f?"":`${t.value}px`,height:t.value in f?"":`${t.value}px`,backgroundColor:`${c.value}`,color:`${l.value}`,marginLeft:(_=p==null?void 0:p.props)!=null&&_.span?`${(y=p==null?void 0:p.props)==null?void 0:y.span}px`:""}});return{classes:u,styles:o,avatarRef:i}}});function Zt(e,t,n,c,l,f){return g(),h("view",{ref:"avatarRef",style:R(e.styles),class:N(e.classes)},[Te(e.$slots,"default")],6)}const en=$e(Qt,[["render",Zt]]);const tn="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Ccircle cx='18' cy='12' r='0' fill='red'%3E%3Canimate attributeName='r' begin='.67' calcMode='spline' dur='1.5s' keySplines='0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8' repeatCount='indefinite' values='0;2;0;0'/%3E%3C/circle%3E%3Ccircle cx='12' cy='12' r='0' fill='red'%3E%3Canimate attributeName='r' begin='.33' calcMode='spline' dur='1.5s' keySplines='0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8' repeatCount='indefinite' values='0;2;0;0'/%3E%3C/circle%3E%3Ccircle cx='6' cy='12' r='0' fill='red'%3E%3Canimate attributeName='r' begin='0' calcMode='spline' dur='1.5s' keySplines='0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8' repeatCount='indefinite' values='0;2;0;0'/%3E%3C/circle%3E%3C!-- 1701252868811 --%3E%3C/svg%3E",je=tn,nn=""+new URL("chatBg-cdb6162e.jpg",import.meta.url).href;var sn=et,an=function(){return sn.Date.now()},on=an,ln=/\s/;function rn(e){for(var t=e.length;t--&&ln.test(e.charAt(t)););return t}var cn=rn,un=cn,dn=/^\s+/;function pn(e){return e&&e.slice(0,un(e)+1).replace(dn,"")}var mn=pn,fn=tt,gn=nt,vn="[object Symbol]";function hn(e){return typeof e=="symbol"||gn(e)&&fn(e)==vn}var _n=hn,yn=mn,ke=ze,bn=_n,Ie=0/0,wn=/^[-+]0x[0-9a-f]+$/i,xn=/^0b[01]+$/i,kn=/^0o[0-7]+$/i,In=parseInt;function Cn(e){if(typeof e=="number")return e;if(bn(e))return Ie;if(ke(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ke(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=yn(e);var n=xn.test(e);return n||kn.test(e)?In(e.slice(2),n?2:8):wn.test(e)?Ie:+e}var $n=Cn,Sn=ze,se=on,Ce=$n,Tn="Expected a function",En=Math.max,zn=Math.min;function On(e,t,n){var c,l,f,p,i,u,o=0,_=!1,y=!1,$=!0;if(typeof e!="function")throw new TypeError(Tn);t=Ce(t)||0,Sn(n)&&(_=!!n.leading,y="maxWait"in n,f=y?En(Ce(n.maxWait)||0,t):f,$="trailing"in n?!!n.trailing:$);function j(v){var I=c,O=l;return c=l=void 0,o=v,p=e.apply(O,I),p}function D(v){return o=v,i=setTimeout(z,t),_?j(v):p}function F(v){var I=v-u,O=v-o,B=t-I;return y?zn(B,f-O):B}function L(v){var I=v-u,O=v-o;return u===void 0||I>=t||I<0||y&&O>=f}function z(){var v=se();if(L(v))return H(v);i=setTimeout(z,F(v))}function H(v){return i=void 0,$&&c?j(v):(c=l=void 0,p)}function G(){i!==void 0&&clearTimeout(i),o=0,c=u=l=i=void 0}function q(){return i===void 0?p:H(se())}function M(){var v=se(),I=L(v);if(c=arguments,l=this,u=v,I){if(i===void 0)return D(u);if(y)return clearTimeout(i),i=setTimeout(z,t),j(u)}return i===void 0&&(i=setTimeout(z,t)),p}return M.cancel=G,M.flush=q,M}var Nn=On;const jn=st(Nn);var K=be.registerPlugin(xt)||be;K.core.Tween;const Pn=ie({__name:"Firework",setup(e,{expose:t}){const n=w(null);let c=null,l=[],f;const p=(o,_)=>{for(let y=0;y<50;y++){const $={x:o,y:_,size:Math.random()*3+1,speedX:(Math.random()-.5)*8,speedY:(Math.random()-.5)*8,color:`hsl(${Math.random()*360}, 50%, 50%)`};l.push($)}},i=()=>{!c||!n.value||(c.fillStyle="rgba(0, 0, 0, 0.1)",c.fillRect(0,0,n.value.width,n.value.height),l.forEach((o,_)=>{o.x+=o.speedX,o.y+=o.speedY,o.size*=.95,o.size<.1&&l.splice(_,1),c.fillStyle=o.color,c.beginPath(),c.arc(o.x,o.y,o.size,0,Math.PI*2),c.fill()}),l.length>0&&(f=requestAnimationFrame(i)))},u=()=>{if(!n.value||!c)return;l=[];const o=n.value.width/2,_=n.value.height/2;p(o,_),i(),setTimeout(()=>{l=[],c&&n.value&&c.clearRect(0,0,n.value.width,n.value.height),cancelAnimationFrame(f)},2e3)};return Oe(()=>{n.value&&(c=n.value.getContext("2d"),n.value.width=window.innerWidth,n.value.height=window.innerHeight)}),at(()=>{cancelAnimationFrame(f)}),t({startFirework:u}),(o,_)=>(g(),h("canvas",{ref_key:"canvas",ref:n,class:"firework-canvas"},null,512))}});const Rn=Ne(Pn,[["__scopeId","data-v-3a19184c"]]),Fn={class:"w-full bg-[#f4f4f4] z-50"},Ln={class:"grid grid-cols-8 gap-[4px] py-[4px]"},Mn=["onClick"],An=ie({__name:"emoji",emits:["emojiClick"],setup(e,{emit:t}){const n=ae(["😀","😄","😆","😅","🤣","😂","🥰","🤩","😘","🥲","😋","🫢","🫣","😝","🫡","🤔","🤨","😑","😏","🙄","😮‍💨","😌","😔","😪","🤒","😎","🤓","🧐","😟","🥹","😳","😠","😵‍💫","🤤","👍","✊","🙏","🤝","👀"]);return(c,l)=>(g(),h("div",Fn,[b("div",Ln,[(g(!0),h(J,null,oe(r(n),(f,p)=>(g(),h("div",{key:p,class:"text-center text-[24px] cursor-pointer",onClick:i=>c.$emit("emojiClick",f)},E(f),9,Mn))),128))])]))}}),le=e=>(ht("data-v-29781bbb"),e=e(),_t(),e),Dn={class:"flex items-center"},Hn=le(()=>b("span",null," 刷新",-1)),Bn=["onClick"],Vn=["src"],Un={class:"text-[12px]"},Wn=["data-id"],Yn=["innerHTML"],Kn={key:0,class:"absolute left-[-20px] top-[10px] text-[#858585]"},Jn={class:"text-red-500 absolute top-[-10px] text-[12px] left-[4px] z-10 bg-white flex"},Xn=le(()=>b("img",{src:je,alt:"",srcset:""},null,-1)),Gn={class:"flex items-center"},qn=le(()=>b("div",{class:"wrapper"},[b("img",{src:nn,class:"w-full",alt:"",srcset:""})],-1)),Qn=ie({__name:"chat",setup(e){ot(s=>({60413745:r(y),"248b7132":r($)}));const t=it("chatId","");t.value=lt().query.id;const n=Ee("socket");console.log(je);const{copy:c}=rt({legacy:!0}),l=ae({msg:"",name:t.value=="1"?"小扈":"老胡",chatId:t.value,picImg:"",type:"text",msgId:""}),f=w(!1),p=ct(),i=w(null),u=w(null),o=w([]),_=w(null),y=X(()=>t.value=="2"?"#282828":"#fff"),$=X(()=>t.value=="2"?"#ccc":"#000"),j=()=>{if(l.msg=="")return A.fail("请输入内容");l.type="text",l.msgId=new Date().getTime().toString(),n.emit("chat",l),o.value.push(JSON.parse(JSON.stringify(l))),l.msg="",D(!1)},D=s=>{ft(()=>{var k,S;K.to(i.value,{scrollTop:(k=i.value)==null?void 0:k.scrollHeight,duration:.3});let a=_.value[((S=_.value)==null?void 0:S.length)-1],m=s?-100:100;K.fromTo(a,{opacity:0,x:m},{opacity:1,duration:.3,x:0}),s&&Ve.observe(a)})};n.on("chat",s=>{var a;o.value.push(s),D(!0),p.value!="visible"&&t.value=="2"&&alert("有消息了"),s.msg&&s.msg.includes("恭喜")&&((a=ue.value)==null||a.startFirework())});const F=w(!1),L=w(!1);let z=null;const H=()=>{clearTimeout(z),F.value||(F.value=!0,n.emit("chatEnter",{entering:!0})),z=setTimeout(()=>{F.value=!1,n.emit("chatEnter",{entering:!1})},3e3)};n.on("chatEnter",s=>{L.value=s.entering}),n.on("chatDelete",s=>{let a=o.value.findIndex(m=>m.msgId==s);o.value.splice(a,1)}),n.on("read",s=>{s.forEach(a=>{let m=o.value.findIndex(k=>k.msgId==(a.msgId||a));o.value[m].isRead=!0})});const G=s=>new Promise(a=>{const m=new FileReader;m.onloadend=k=>a(k.target.result),m.readAsDataURL(s)}),q=(s,a,m)=>new Promise(k=>s.toBlob(S=>k(S),a,m)),M=s=>new Promise(a=>{const m=new Image;m.onload=()=>a(m),m.src=s}),v=s=>{l.picImg=JSON.parse(s.responseText).data,l.msgId=new Date().getTime().toString(),n.emit("chat",l),u.value.clearUploadQueue(),l.picImg=""},I=s=>{A.fail(s)},O=async s=>{if(B(s[0])){l.type="img";let m=s[0].name;const k=document.createElement("canvas"),S=k.getContext("2d"),ee=await G(s[0]),T=await M(ee);k.width=T.width,k.height=T.height,S.clearRect(0,0,T.width,T.height),S.drawImage(T,0,0,T.width,T.height);let te=await q(k,"image/jpeg",.5);return[await new File([te],m)]}l.type="file";let a=await new File([s[0]],s[0].name);return console.log(a),[a]};function B(s){return s.type.startsWith("image/")}const Pe=s=>{const a=document.createElement("a");a.href=s,a.download=s.slice(s.lastIndexOf("/"),s.length),a.click()};Oe(()=>{});const Re=w(20),V=w(1),re=async()=>{let s=await gt.get("/chatList",{params:{pageSize:Re.value,pageNum:V.value}});o.value.unshift(...s.data),Fe.value=!1,V.value==1&&setTimeout(()=>{K.to(i.value,{scrollTop:i.value.scrollHeight,duration:.5});let a=o.value.filter(m=>m.chatId!=t.value);a.length>0&&n.emit("read",a)},500),s.data.length==0&&De()};re();const Fe=w(!1),{y:Q,directions:Le}=ut(i,{offset:{top:30,bottom:30,right:30,left:30}}),Me=jn(async()=>{var a,m;V.value++;let s=(a=i.value)==null?void 0:a.scrollHeight;await re(),Q.value=((m=i.value)==null?void 0:m.scrollHeight)-s-10},500),Ae=()=>{V.value=0,o.value=[]},De=dt(Q,()=>{Q.value<11&&Le.top&&Me()}),U=w(!1),W=w(!1),He=ae([{name:"删除当条消息",type:"delete"},{name:"复制消息",type:"copy"}]),Z=w(""),Be=async s=>{if(s.type=="delete")n.emit("chatDelete",Z.value),A.success("删除成功");else{let a=o.value.find(m=>m.msgId==Z.value);console.log(a);try{await c(a.msg||a.picImg),A.success("复制成功")}catch{A.fail("复制失败")}}},Ve=new IntersectionObserver(s=>{s.forEach(a=>{a.isIntersecting&&(console.log(ge().format("YYYY-MM-DD HH:mm:ss")),console.log(p.value),p.value=="visible"&&n.emit("read",[a.target.dataset.id]))})},{}),Ue=s=>{l.msg=l.msg+s},ce=w(null);pt(ce,()=>{f.value&&(f.value=!1)});const We=()=>{f.value||(f.value=!0)},ue=w(null);return(s,a)=>{const m=kt,k=en,S=ye,ee=wt,T=ye,te=bt,de=vt,Ye=Xt;return g(),h(J,null,[x(m,{title:"小小聊天室",fixed:"",style:{background:"#000"},onClickRight:a[0]||(a[0]=d=>U.value=!0),onClickBack:Ae,border:!1},{left:C(()=>[b("div",Dn,[Hn,x(r(It),{width:"18px"})])]),right:C(()=>[x(r(zt),{class:"right",width:"18px"})]),_:1}),b("div",{style:R([{height:"calc(100vh - 96px)"},{background:r(y)}]),class:"overflow-y-auto overflow-x-hidden",ref_key:"chatBox",ref:i},[b("ul",null,[(g(!0),h(J,null,oe(r(o),d=>(g(),h("li",{class:N(["flex mt-[10px] mb-[24px]",{"flex-row-reverse":d.chatId==r(t)}]),key:d.msgId},[x(k,{onClick:pe=>{W.value=!0,Z.value=d.msgId},class:"z-20 relative",color:r(t)=="2"?r($):"rgb(245, 106, 0)","bg-color":r(t)=="2"?r(y):"rgb(253, 227, 207)"},{default:C(()=>[Y(E(d.name),1)]),_:2},1032,["onClick","color","bg-color"]),d.type=="img"?(g(),h("div",{key:0,onClick:pe=>r(Ct)({show:!0,images:[{src:d.picImg}]}),class:"mx-[12px]"},[b("img",{src:d.picImg,alt:"",srcset:""},null,8,Vn)],8,Bn)):d.type=="file"?(g(),h("div",{key:1,class:N(["flex items-center max-w-[82%] overflow-hidden",[d.chatId==r(t)?"mr-[12px]":"ml-[12px]"]])},[b("span",Un,"文件："+E(d.picImg.slice(d.picImg.lastIndexOf("/"),d.picImg.length)),1),x(S,{size:"small",onClick:pe=>Pe(d.picImg)},{default:C(()=>[Y("点击下载")]),_:2},1032,["onClick"])],2)):(g(),h("div",{key:2,ref_for:!0,ref_key:"chatList",ref:_,class:N(["bg-gray-100 rounded-lg text-[14px] max-w-[82%] p-[4px] relative z-10",[d.chatId==r(t)?"mr-[12px] ml-[12px]":"ml-[12px] mr-[12px] bg-green-500 text-white"]]),"data-id":d.msgId,style:R({background:r(t)=="2"?"#000":"",color:r(t)=="2"?"#ccc":""})},[b("span",{class:"inline-block w-full overflow-hidden",innerHTML:d.msg},null,8,Yn),d.chatId==r(t)?(g(),h("span",Kn,[x(ne,{size:"18",icon:d.isRead?"ion:checkmark-done-outline":"ion:checkmark-outline"},null,8,["icon"])])):P("",!0),b("span",{class:N(["absolute text-[10px] text-gray-400 bottom-[-14px] whitespace-nowrap",[d.chatId==r(t)?"right-0":"left-0"]])},E(r(ge)(d.time).format("MM-DD HH:mm:ss")),3)],14,Wn))],2))),128))])],4),b("div",{class:"relative",style:R({background:r(y)})},[ve(b("span",Jn,[Y("对方正在输入中"),Xn],512),[[he,r(L)]]),x(te,{modelValue:r(l).msg,"onUpdate:modelValue":a[1]||(a[1]=d=>r(l).msg=d),onKeyup:mt(j,["enter"]),onInput:H,placeholder:"请输入内容",clearable:""},{right:C(()=>[b("div",Gn,[x(ne,{icon:"carbon:face-wink",size:"24",class:"mr-[10px] cursor-pointer",onClick:We}),x(ee,{ref_key:"myUploader",ref:u,url:"/api/upload",onSuccess:v,"before-upload":O,onFailure:I,name:"image"},{default:C(()=>[x(r(yt),{name:"image",size:"24"})]),_:1},512),x(T,{style:{"margin-left":"10px"},type:"primary",size:"small",icon:"",onClick:j},{icon:C(()=>[x(ne,{icon:"ion:paper-plane-outline"})]),default:C(()=>[Y("发送 ")]),_:1})])]),_:1},8,["modelValue","onKeyup"]),ve(x(An,{ref_key:"emojiRef",ref:ce,onEmojiClick:Ue,class:"absolute top-[-200px]"},null,512),[[he,r(f)]])],4),x(de,{visible:r(U),"onUpdate:visible":a[2]||(a[2]=d=>_e(U)?U.value=d:null)},{default:C(()=>[qn]),_:1},8,["visible"]),x(Ye,{visible:r(W),"onUpdate:visible":a[3]||(a[3]=d=>_e(W)?W.value=d:null),"cancel-txt":"取消","menu-items":r(He),onChoose:Be},null,8,["visible","menu-items"]),x(Rn,{ref_key:"fireworkRef",ref:ue},null,512)],64)}}});const rs=Ne(Qn,[["__scopeId","data-v-29781bbb"]]);export{rs as default};
