import{a as J,r as V,c as E,w as x,N as he,L as te,_ as de,b as me,h as ge,o as P,d as U,e as F,H as B,k as Q,f as ne,F as W,C as le,s as u,n as q,$ as ae,l as ye,a0 as be,m as ke,q as we,a1 as oe,v as f,t as m,x as X,T as _e,A as R,j as se,a2 as re,z as Z,y as K}from"./index-6ced0f24.js";import{F as Te,a as Ne}from"./index-24c72053.js";import{U as Se}from"./index-b0a43757.js";import{R as De,a as Oe}from"./index-99434d9f.js";import{I as Ve}from"./index-42d7c71b.js";import{B as ue}from"./index-ba695628.js";import{P as $e,T as Ce}from"./index-4ee5354f.js";import{C as Pe}from"./index-6223d38a.js";import{w as Ie}from"./Plus-4c06e122.js";import{p as Me}from"./pxCheck-c6b9f6b7-e26267bf.js";import{u as He}from"./index-7a7385e4-9157872d.js";import"./Cell-23ea0724.js";import"./Checked-72beb956.js";import"./CheckNormal-093b1146.js";var Re=Object.defineProperty,Ue=Object.defineProperties,Ye=Object.getOwnPropertyDescriptors,ie=Object.getOwnPropertySymbols,Ee=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable,ce=(e,a,c)=>a in e?Re(e,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):e[a]=c,G=(e,a)=>{for(var c in a||(a={}))Ee.call(a,c)&&ce(e,c,a[c]);if(ie)for(var c of ie(a))Fe.call(a,c)&&ce(e,c,a[c]);return e},pe=(e,a)=>Ue(e,Ye(a));const Le={text:"text",value:"value",children:"children"},Ae=(e,a)=>{const c=J({formattedColumns:e.columns}),t=E(()=>G(G({},Le),e.fieldNames)),i=V([]),N=E(()=>{const o=t.value;return M.value.map((h,C)=>{const p=h.findIndex(S=>S[o.value]===i.value[C]);return p===-1?0:p})}),d=V([]),k=o=>{o&&d.value.length<M.value.length&&d.value.push(o)},v=E(()=>{const o=t.value;return M.value.map((h,C)=>h.find(p=>p[o.value]===i.value[C])||h[0])}),s=E(()=>{const o=c.formattedColumns[0],h=t.value;if(o){if(Array.isArray(o))return"multiple";if(h.children in o)return"cascade"}return"single"}),M=E(()=>{let o=[];switch(s.value){case"multiple":o=c.formattedColumns;break;case"cascade":o=$(c.formattedColumns,i.value?i.value:[]);break;default:o=[c.formattedColumns];break}return o}),$=(o,h)=>{const C=[],p=t.value;let S={text:"",value:"",[p.children]:o},_=0;for(;S&&S[p.children];){const A=S[p.children],r=h[_];let n=A.findIndex(l=>l[p.value]===r);n===-1&&(n=0),S=S[p.children][n],_++,C.push(A)}return C},Y=()=>{a("cancel",{selectedValue:i.value,selectedOptions:v.value})},D=(o,h)=>{var C;const p=t.value;if(h&&Object.keys(h).length){if(i.value=i.value?i.value:[],s.value==="cascade"){i.value[o]=(C=h[p.value])!=null?C:"";let S=o,_=h;for(;_&&_[p.children]&&_[p.children][0];)i.value[S+1]=_[p.children][0][p.value],S++,_=_[p.children][0];_&&_[p.children]&&_[p.children].length===0&&(i.value=i.value.slice(0,S+1))}else i.value[o]=Object.prototype.hasOwnProperty.call(h,p.value)?h[p.value]:"";a("change",{columnIndex:o,selectedValue:i.value,selectedOptions:v.value})}},j=()=>{const o=t.value;i.value&&!i.value.length&&M.value.forEach(h=>{i.value.push(h[0][o.value])}),a("confirm",{selectedValue:i.value,selectedOptions:v.value})},L=(o,h)=>JSON.stringify(o)===JSON.stringify(h);return x(()=>e.modelValue,o=>{L(o,i.value)||(i.value=o)},{deep:!0,immediate:!0}),x(i,o=>{L(o,e.modelValue)||a("update:modelValue",o)},{deep:!0}),x(()=>e.columns,o=>{o.length&&(c.formattedColumns=o)}),pe(G({},te(c)),{columnsType:s,columnsList:M,columnFieldNames:t,cancel:Y,changeHandler:D,confirm:j,defaultValues:i,defaultIndexes:N,pickerColumn:d,swipeRef:k,selectedOptions:v,isSameValue:L})},{create:Be}=me("picker-column"),je=Be({props:{value:[String,Number],columnsType:String,column:{type:Array,default:()=>[]},threeDimensional:{type:Boolean,default:!0},swipeDuration:{type:[Number,String],default:1e3},visibleOptionNum:{type:[Number,String],default:7},optionHeight:{type:[Number,String],default:36},fieldNames:{type:Object,default:()=>({})},taro:{type:Boolean,defualt:!1}},emits:["click","change"],setup(e,{emit:a}){const c=He(),t=J({touchParams:{startY:0,endY:0,startTime:0,endTime:0,lastY:0,lastTime:0},currIndex:1,transformY:0,scrollDistance:0,rotation:20}),i=V(null),N=V(!1),d=V(0),k=V(0),v=200,s=300,M=15,$=E(()=>({transition:`transform ${k.value}ms cubic-bezier(0.17, 0.89, 0.45, 1)`,transform:`rotate3d(1, 0, 0, ${d.value})`,top:`calc(50% - ${+e.optionHeight/2}px)`})),Y=E(()=>{const{optionHeight:l}=e;return{transition:`transform ${k.value}ms cubic-bezier(0.17, 0.89, 0.45, 1)`,transform:`translate3d(0, ${t.scrollDistance}px, 0)`,top:`calc(50% - ${+l/2}px)`,height:`${l}px`}}),D=l=>`transform: rotate3d(1, 0, 0, ${-t.rotation*l}deg) translate3d(0px, 0px, 104px)`,j=E(()=>({backgroundSize:`100% ${(+e.visibleOptionNum-1)*+e.optionHeight/2}px`})),L=l=>{if(c.start(l),N.value&&!e.taro){const g=i.value,{transform:w}=window.getComputedStyle(g);if(e.threeDimensional){const y=Math.floor(parseInt(d.value)/360),T=+w.split(", ")[5],O=+w.split(", ")[6]<0?180:0,I=y*360+Math.acos(T)/Math.PI*180+O;t.scrollDistance=-Math.abs((I/t.rotation-1)*+e.optionHeight)}else t.scrollDistance=+w.slice(7,w.length-1).split(", ")[5]}ae(l,!0),t.touchParams.startY=c.deltaY.value,t.touchParams.startTime=Date.now(),t.transformY=t.scrollDistance},o=l=>{c.move(l),c.isVertical()&&(N.value=!0,ae(l,!0)),t.touchParams.lastY=c.deltaY.value;let g=t.touchParams.lastY-t.touchParams.startY;_(g)},h=()=>{t.touchParams.lastY=c.deltaY.value,t.touchParams.lastTime=Date.now();let l=t.touchParams.lastY-t.touchParams.startY,g=t.touchParams.lastTime-t.touchParams.startTime;if(g<=s&&Math.abs(l)>M){const w=C(l,g);_(w,"end",+e.swipeDuration);return}else _(l,"end");setTimeout(()=>{c.reset(),N.value=!1},0)},C=(l,g)=>(l=Math.abs(l/g)/.003*(l<0?-1:1),l),p=l=>l>=t.currIndex+8||l<=t.currIndex-8,S=(l=0,g,w=v,y)=>{g==="end"?k.value=w:k.value=0,d.value=y,t.scrollDistance=l},_=(l,g,w)=>{const{optionHeight:y}=e;let T=l+t.transformY;if(g==="end"){T>0&&(T=0),T<-(e.column.length-1)*+y&&(T=-(e.column.length-1)*+y);let O=Math.round(T/+y)*+y,I=`${(Math.abs(Math.round(O/+y))+1)*t.rotation}deg`;S(O,g,w,I),t.currIndex=Math.abs(Math.round(O/+y))+1}else{let O=0,I=(-T/+y+1)*t.rotation;const H=(e.column.length+1)*t.rotation,z=0;O=be(I,z,H),z<O&&O<H&&(S(T,null,void 0,O+"deg"),t.currIndex=Math.abs(Math.round(T/+y))+1)}},A=()=>{a("change",e.column[t.currIndex-1])},r=l=>{const{column:g}=e;let w=g.findIndex(T=>T[e.fieldNames.value]===e.value);t.currIndex=w===-1?1:w+1;let y=w===-1?0:w*+e.optionHeight;l&&A(),_(-y)},n=()=>{N.value=!1,k.value=0,A()};return x(()=>e.column,()=>{e.column&&e.column.length>0&&(t.transformY=0,r(!1))},{deep:!0}),x(()=>e.value,()=>{t.transformY=0,r(!1)},{deep:!0}),he(()=>{r(!0)}),pe(G(G({},te(t)),te(e)),{setRollerStyle:D,isHidden:p,roller:i,onTouchStart:L,onTouchMove:o,onTouchEnd:h,touchRollerStyle:$,touchTileStyle:Y,setMove:_,stopMomentum:n,pxCheck:Me,maskStyles:j})}});function ze(e,a,c,t,i,N){return P(),U("view",{class:"nut-picker__list",onTouchstart:a[1]||(a[1]=(...d)=>e.onTouchStart&&e.onTouchStart(...d)),onTouchmove:a[2]||(a[2]=(...d)=>e.onTouchMove&&e.onTouchMove(...d)),onTouchend:a[3]||(a[3]=(...d)=>e.onTouchEnd&&e.onTouchEnd(...d))},[F("view",{ref:"roller",class:"nut-picker-roller",style:q(e.threeDimensional?e.touchRollerStyle:e.touchTileStyle),onTransitionend:a[0]||(a[0]=(...d)=>e.stopMomentum&&e.stopMomentum(...d))},[(P(!0),U(W,null,le(e.column,(d,k)=>{var v;return P(),U(W,{key:(v=d[e.fieldNames.value])!=null?v:k},[d&&d[e.fieldNames.text]&&e.threeDimensional?(P(),U("view",{key:0,class:ye(["nut-picker-roller-item",{"nut-picker-roller-item-hidden":e.isHidden(k+1)}]),style:q(e.setRollerStyle(k+1))},B(d[e.fieldNames.text]),7)):Q("",!0),d&&d[e.fieldNames.text]&&!e.threeDimensional?(P(),U("view",{key:1,class:"nut-picker-roller-item-tile",style:q({height:e.pxCheck(e.optionHeight),lineHeight:e.pxCheck(e.optionHeight)})},B(d[e.fieldNames.text]),5)):Q("",!0)],64)}),128))],36),F("view",{class:"nut-picker-roller-mask",style:q(e.maskStyles)},null,4)],32)}const ee=de(je,[["render",ze]]),xe={modelValue:{type:Array,default:()=>[]},title:{type:String,default:""},cancelText:{type:String,default:""},okText:{type:String,default:""},columns:{type:Array,default:()=>[]},threeDimensional:{type:Boolean,default:!1},swipeDuration:{type:[Number,String],default:1e3},showToolbar:{type:Boolean,default:!0},visibleOptionNum:{type:[Number,String],default:7},optionHeight:{type:[Number,String],default:36},fieldNames:{type:Object,default:()=>({})}},{create:qe,translate:Je}=me("picker"),Ge=qe({components:{[ee.name]:ee},props:xe,emits:["cancel","change","confirm","update:modelValue"],setup(e,{emit:a}){const{changeHandler:c,confirm:t,defaultValues:i,columnsList:N,columnsType:d,columnFieldNames:k,cancel:v}=Ae(e,a),s=V([]),M=D=>{D&&s.value.length<N.value.length&&s.value.push(D)},$=E(()=>{const D={};return D.height=`${+e.visibleOptionNum*+e.optionHeight}px`,D["--lineHeight"]=`${+e.optionHeight}px`,D});return{column:ee,columnsType:d,columnsList:N,columnFieldNames:k,cancel:v,changeHandler:c,confirmHandler:()=>{s.value.length>0&&s.value.forEach(D=>{D.stopMomentum()}),t()},defaultValues:i,translate:Je,pickerColumn:s,swipeRef:M,columnStyle:$}}}),Ke={class:"nut-picker"},Qe={key:0,class:"nut-picker__bar"},We={class:"nut-picker__title"};function Xe(e,a,c,t,i,N){const d=ge("nut-picker-column");return P(),U("div",Ke,[e.showToolbar?(P(),U("view",Qe,[F("view",{class:"nut-picker__left",onClick:a[0]||(a[0]=(...k)=>e.cancel&&e.cancel(...k))},B(e.cancelText||e.translate("cancel")),1),F("view",We,B(e.title),1),F("view",{class:"nut-picker__right",onClick:a[1]||(a[1]=(...k)=>e.confirmHandler&&e.confirmHandler(...k))},B(e.okText||e.translate("confirm")),1)])):Q("",!0),ne(e.$slots,"top"),F("view",{class:"nut-picker__column",style:q(e.columnStyle)},[(P(!0),U(W,null,le(e.columnsList,(k,v)=>(P(),U("view",{key:v,class:"nut-picker__columnitem"},[u(d,{ref_for:!0,ref:e.swipeRef,column:k,"columns-type":e.columnsType,"field-names":e.columnFieldNames,value:e.defaultValues&&e.defaultValues[v],"three-dimensional":e.threeDimensional,"swipe-duration":e.swipeDuration,"visible-option-num":e.visibleOptionNum,"option-height":e.optionHeight,onChange:s=>{e.changeHandler(v,s)}},null,8,["column","columns-type","field-names","value","three-dimensional","swipe-duration","visible-option-num","option-height","onChange"])]))),128))],4),ne(e.$slots,"default")])}const Ze=de(Ge,[["render",Xe]]),et=e=>e,tt=et(Ze);const lt={class:"p-2 pb-[50px]"},nt={class:"p-[12px]"},at={class:"pt-[18px] px-[20px]"},bt=ke({__name:"manage",setup(e){const a=we();a.getMenu();const c=J([{title:"菜名",key:"name",align:"center"},{title:"价格",key:"price",align:"center",sorter:(r,n)=>n.price-r.price},{title:"类型",key:"type",align:"center",render:r=>{var n;return(n=a.selectList.find(l=>l.value==r.type))==null?void 0:n.text}},{title:"操作",key:"render",align:"center",render:r=>_e(ue,{onClick:()=>{Object.assign(s,r),$.value="edit",Y.value=r.isOnline?"1":"0",s.type=r.type+"",v.value=!0},size:"small",type:"primary"},()=>"修改")}]),t=V(!1),i=V("全部"),N=V(0),d=r=>{t.value=!1,i.value=r.selectedOptions[0].text,N.value=r.selectedOptions[0].value,a.getMenu(Number(N.value))},k=V(null),v=V(!1),s=J({id:"",name:"",price:"",type:"1",picImg:"",isOnline:"",unit:"串"}),M=oe(s),$=V("add"),Y=V("1"),D=()=>{k.value.validate().then(r=>{if(!r.valid)return;let n={...s,type:Number(s.type),price:Number(s.price),isOnline:Y.value=="1",picImg:s.picImg.includes("http")?"":s.picImg};$.value=="edit"&&Z.post("/updateMenu",n).then(()=>{K.success("修改成功"),a.getMenu(Number(N.value)),v.value=!1}),$.value=="add"&&Z.post("/addMenu",n).then(()=>{K.success("添加成功"),a.getMenu(Number(N.value)),v.value=!1})})},j=r=>{k.value.validate(r).then(()=>{})},L=r=>/^\d+(\.\d+)?$/.test(r)?Promise.resolve():Promise.reject("必须输入数字");x(()=>s.unit,r=>{console.log(r)});const o=r=>{s.picImg=JSON.parse(r.responseText).data,K.success("上传成功")},h=J(oe(a.selectList));h.unshift({text:"全部",value:0});const C=()=>{Z.post("/deleteMenu",{id:s.id}).then(()=>{K.success("删除成功"),a.getMenu(Number(N.value)),v.value=!1})},p=r=>new Promise(n=>{const l=new FileReader;l.onloadend=g=>n(g.target.result),l.readAsDataURL(r)}),S=r=>new Promise(n=>{const l=new Image;l.onload=()=>n(l),l.src=r}),_=(r,n,l)=>new Promise(g=>r.toBlob(w=>g(w),n,l)),A=async r=>{let n=r[0].name;const l=document.createElement("canvas"),g=l.getContext("2d"),w=await p(r[0]),y=await S(w);l.width=y.width,l.height=y.height,g.clearRect(0,0,y.width,y.height),g.drawImage(y,0,0,y.width,y.height);let T=await _(l,"image/jpeg",.5);return[await new File([T],n)]};return(r,n)=>{const l=Pe,g=tt,w=$e,y=Ce,T=ue,O=Ve,I=Te,H=De,z=Oe,fe=Se,ve=Ne;return P(),U("div",lt,[u(l,{title:"请选择分类",desc:f(i),onClick:n[0]||(n[0]=b=>t.value=!0)},null,8,["desc"]),u(w,{position:"bottom",visible:f(t),"onUpdate:visible":n[2]||(n[2]=b=>X(t)?t.value=b:null)},{default:m(()=>[u(g,{threeDimensional:"",columns:f(h),title:"请选择分类",onConfirm:d,onCancel:n[1]||(n[1]=b=>t.value=!1)},null,8,["columns"])]),_:1},8,["visible"]),u(y,{columns:f(c),data:f(a).productList},null,8,["columns","data"]),F("div",nt,[u(T,{block:"",type:"primary",onClick:n[3]||(n[3]=b=>{v.value=!0,$.value="add",Object.assign(f(s),f(M))})},{icon:m(()=>[u(f(Ie))]),default:m(()=>[R(" 添加菜品 ")]),_:1})]),u(w,{position:"right",closeable:"","close-icon-position":"top-left",visible:f(v),"onUpdate:visible":n[12]||(n[12]=b=>X(v)?v.value=b:null),style:{height:"100%",width:"100%"}},{default:m(()=>[F("div",at,[u(ve,{"model-value":f(s),ref_key:"ruleForm",ref:k},{default:m(()=>[u(I,{label:"菜名",prop:"name",onBlur:n[5]||(n[5]=b=>j("name")),required:"",rules:[{required:!0,message:"请填写菜名"}]},{default:m(()=>[u(O,{class:"nut-input-text",rules:[{required:!0,message:"请填写菜名"}],modelValue:f(s).name,"onUpdate:modelValue":n[4]||(n[4]=b=>f(s).name=b),placeholder:"请填写要添加的菜名",type:"text"},null,8,["modelValue"])]),_:1}),u(I,{label:"价格",prop:"price",onBlur:n[7]||(n[7]=b=>j("price")),required:"",rules:[{required:!0,message:"请填写价格"},{validator:L,message:"必须输入数字"}]},{default:m(()=>[u(O,{class:"nut-input-text",modelValue:f(s).price,"onUpdate:modelValue":n[6]||(n[6]=b=>f(s).price=b),placeholder:"请输入单价",type:"text"},null,8,["modelValue"])]),_:1},8,["rules"]),u(I,{label:"单位",prop:"unit"},{default:m(()=>[u(z,{direction:"horizontal",modelValue:f(s).unit,"onUpdate:modelValue":n[8]||(n[8]=b=>f(s).unit=b)},{default:m(()=>[u(H,{label:"串"},{default:m(()=>[R("串")]),_:1}),u(H,{label:"份"},{default:m(()=>[R("份")]),_:1}),u(H,{label:"瓶"},{default:m(()=>[R("瓶")]),_:1}),u(H,{label:"件"},{default:m(()=>[R("件")]),_:1}),u(H,{label:"个"},{default:m(()=>[R("个")]),_:1})]),_:1},8,["modelValue"])]),_:1}),u(I,{label:"是否上架",prop:"isOnline"},{default:m(()=>[u(z,{direction:"horizontal",modelValue:f(Y),"onUpdate:modelValue":n[9]||(n[9]=b=>X(Y)?Y.value=b:null)},{default:m(()=>[u(H,{label:"1"},{default:m(()=>[R("上架")]),_:1}),u(H,{label:"0"},{default:m(()=>[R("下架")]),_:1})]),_:1},8,["modelValue"])]),_:1}),u(I,{label:"所属分类",prop:"type"},{default:m(()=>[u(z,{direction:"horizontal",modelValue:f(s).type,"onUpdate:modelValue":n[10]||(n[10]=b=>f(s).type=b)},{default:m(()=>[(P(!0),U(W,null,le(f(a).selectList,b=>(P(),se(H,{label:b.value,key:b.value},{default:m(()=>[R(B(b.text),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(I,{label:"预览图片上传",prop:"picImg"},{default:m(()=>[u(fe,{url:"/api/upload",accept:"image/*",modelValue:f(s).picImg,"onUpdate:modelValue":n[11]||(n[11]=b=>f(s).picImg=b),onSuccess:o,"before-upload":A,name:"image"},null,8,["modelValue"])]),_:1}),u(l,null,{default:m(()=>[u(T,{block:"",type:"primary",onClick:D},{icon:m(()=>[u(re,{icon:f($)=="edit"?"mdi:circle-edit-outline":"ion:plus"},null,8,["icon"])]),default:m(()=>[R("确认"+B(f($)=="edit"?"修改":"添加")+" ",1)]),_:1})]),_:1}),u(l,null,{default:m(()=>[f($)=="edit"?(P(),se(T,{key:0,block:"",type:"warning",onClick:C},{icon:m(()=>[u(re,{icon:"ion:trash-outline"})]),default:m(()=>[R(" 删 除 ")]),_:1})):Q("",!0)]),_:1})]),_:1},8,["model-value"])])]),_:1},8,["visible"])])}}});export{bt as default};
