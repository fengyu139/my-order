import{b as J,r as C,c as U,a as q,K as he,L as te,M as de,O as pe,P as ge,Q as ye,o as H,e as L,f as A,G as j,l as W,g as ne,F as X,C as le,t as i,n as x,a0 as ae,m as oe,a1 as be,d as ke,s as Ne,a2 as se,u as v,v as d,x as Z,N as we,_ as re,W as Te,A as E,h as ue,a3 as ie,z as ee,y as Q}from"./index-1a998e25.js";import{_ as _e,a as $e}from"./index-0426dddc.js";import{i as Se}from"./index-10209793.js";import{_ as De,a as Oe}from"./index-6824c424.js";import{_ as Pe}from"./index-9120f2a1.js";/* empty css              */import{i as Ve}from"./index-1f9f1b2b.js";/* empty css              *//* empty css              */import{w as Ce}from"./Plus-ddd558e3.js";import{p as Me}from"./pxCheck-DN6FYV6q-3938f682.js";import{u as Ie}from"./index-I8tfW3Kf-71bb0ac5.js";import{_ as He}from"./Cell-39b9cfde.js";import"./common-BH7uB7Cn-929e3022.js";import"./Checked-734d72ff.js";import"./CheckNormal-a7c26b17.js";var Ye=Object.defineProperty,Ee=Object.defineProperties,Le=Object.getOwnPropertyDescriptors,ce=Object.getOwnPropertySymbols,Re=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable,me=(e,n,m)=>n in e?Ye(e,n,{enumerable:!0,configurable:!0,writable:!0,value:m}):e[n]=m,G=(e,n)=>{for(var m in n||(n={}))Re.call(n,m)&&me(e,m,n[m]);if(ce)for(var m of ce(n))Ue.call(n,m)&&me(e,m,n[m]);return e},fe=(e,n)=>Ee(e,Le(n));const Ae={text:"text",value:"value",children:"children",className:"className"},Fe=(e,n)=>{const m=J({formattedColumns:e.columns}),l=U(()=>G(G({},Ae),e.fieldNames)),c=C([]),$=U(()=>{const o=l.value;return D.value.map((y,I)=>{const f=y.findIndex(P=>P[o.value]===c.value[I]);return f===-1?0:f})}),r=C([]),h=o=>{o&&r.value.length<D.value.length&&r.value.push(o)},g=U(()=>{const o=l.value;return D.value.map((y,I)=>y.find(f=>f[o.value]===c.value[I])||y[0])}),u=U(()=>{const o=m.formattedColumns[0],y=l.value;if(o){if(Array.isArray(o))return"multiple";if(y.children in o)return"cascade"}return"single"}),D=U(()=>{let o=[];switch(u.value){case"multiple":o=m.formattedColumns;break;case"cascade":o=M(m.formattedColumns,c.value?c.value:[]);break;default:o=[m.formattedColumns];break}return o}),M=(o,y)=>{const I=[],f=l.value;let P={text:"",value:"",[f.children]:o},T=0;for(;P&&P[f.children];){const R=P[f.children],s=y[T];let t=R.findIndex(k=>k[f.value]===s);t===-1&&(t=0),P=P[f.children][t],T++,I.push(R)}return I},Y=()=>{n("cancel",{selectedValue:c.value,selectedOptions:g.value})},B=(o,y)=>{var I;const f=l.value;if(y&&Object.keys(y).length){if(c.value=c.value?c.value:[],u.value==="cascade"){c.value[o]=(I=y[f.value])!=null?I:"";let P=o,T=y;for(;T&&T[f.children]&&T[f.children][0];)c.value[P+1]=T[f.children][0][f.value],P++,T=T[f.children][0];T&&T[f.children]&&T[f.children].length===0&&(c.value=c.value.slice(0,P+1))}else c.value[o]=Object.prototype.hasOwnProperty.call(y,f.value)?y[f.value]:"";n("change",{columnIndex:o,selectedValue:c.value,selectedOptions:g.value})}},O=()=>{const o=l.value;c.value&&!c.value.length&&D.value.forEach(y=>{c.value.push(y[0][o.value])}),n("confirm",{selectedValue:c.value,selectedOptions:g.value})},F=(o,y)=>JSON.stringify(o)===JSON.stringify(y);return q(()=>e.modelValue,o=>{F(o,c.value)||(c.value=o)},{deep:!0,immediate:!0}),q(c,o=>{F(o,e.modelValue)||n("update:modelValue",o)},{deep:!0}),q(()=>e.columns,o=>{m.formattedColumns=o}),fe(G({},te(m)),{columnsType:u,columnsList:D,columnFieldNames:l,cancel:Y,changeHandler:B,confirm:O,defaultValues:c,defaultIndexes:$,pickerColumn:r,swipeRef:h,selectedOptions:g,isSameValue:F})},{create:je}=pe("picker-column"),Be=je({props:{value:[String,Number],columnsType:String,column:{type:Array,default:()=>[]},threeDimensional:{type:Boolean,default:!0},swipeDuration:{type:[Number,String],default:1e3},visibleOptionNum:{type:[Number,String],default:7},optionHeight:{type:[Number,String],default:36},fieldNames:{type:Object,default:()=>({})},taro:{type:Boolean,default:!1}},emits:["click","change"],setup(e,{emit:n}){const m=Ie(),l=J({touchParams:{startY:0,endY:0,startTime:0,endTime:0,lastY:0,lastTime:0},currIndex:1,transformY:0,scrollDistance:0,rotation:20}),c=C(null),$=C(!1),r=C(0),h=C(0),g=200,u=300,D=15,M=U(()=>({transition:`transform ${h.value}ms cubic-bezier(0.17, 0.89, 0.45, 1)`,transform:`rotate3d(1, 0, 0, ${r.value})`,top:`calc(50% - ${+e.optionHeight/2}px)`})),Y=U(()=>{const{optionHeight:a}=e;return{transition:`transform ${h.value}ms cubic-bezier(0.17, 0.89, 0.45, 1)`,transform:`translate3d(0, ${l.scrollDistance}px, 0)`,top:`calc(50% - ${+a/2}px)`,height:`${a}px`}}),B=a=>`transform: rotate3d(1, 0, 0, ${-l.rotation*a}deg) translate3d(0px, 0px, 104px)`,O=U(()=>({backgroundSize:`100% ${(+e.visibleOptionNum-1)*+e.optionHeight/2}px`})),F=a=>{if(m.start(a),$.value&&!e.taro){const N=c.value,{transform:p}=window.getComputedStyle(N);if(e.threeDimensional){const w=Math.floor(parseInt(r.value)/360),S=+p.split(", ")[5],_=+p.split(", ")[6]<0?180:0,V=w*360+Math.acos(S)/Math.PI*180+_;l.scrollDistance=-Math.abs((V/l.rotation-1)*+e.optionHeight)}else l.scrollDistance=+p.slice(7,p.length-1).split(", ")[5]}ae(a,!0),l.touchParams.startY=m.deltaY.value,l.touchParams.startTime=Date.now(),l.transformY=l.scrollDistance},o=a=>{m.move(a),m.isVertical()&&($.value=!0,ae(a,!0)),l.touchParams.lastY=m.deltaY.value;let N=l.touchParams.lastY-l.touchParams.startY;R(N)},y=()=>{l.touchParams.lastY=m.deltaY.value,l.touchParams.lastTime=Date.now();let a=l.touchParams.lastY-l.touchParams.startY,N=l.touchParams.lastTime-l.touchParams.startTime;if(N<=u&&Math.abs(a)>D){const p=I(a,N);R(p,"end",+e.swipeDuration);return}else R(a,"end");setTimeout(()=>{m.reset(),$.value=!1},0)},I=(a,N)=>(a=Math.abs(a/N)/.003*(a<0?-1:1),a),f=a=>a>=l.currIndex+8||a<=l.currIndex-8,P=a=>a==l.currIndex,T=(a=0,N,p=g,w)=>{N==="end"?h.value=p:h.value=0,r.value=w,l.scrollDistance=a},R=(a,N,p)=>{const{optionHeight:w}=e;let S=a+l.transformY;if(N==="end"){S>0&&(S=0),S<-(e.column.length-1)*+w&&(S=-(e.column.length-1)*+w);let _=Math.round(S/+w)*+w,V=`${(Math.abs(Math.round(_/+w))+1)*l.rotation}deg`;T(_,N,p,V),l.currIndex=Math.abs(Math.round(_/+w))+1}else{let _=0,V=(-S/+w+1)*l.rotation;const z=(e.column.length+1)*l.rotation,K=0;_=be(V,K,z),K<_&&_<z&&(T(S,null,void 0,_+"deg"),l.currIndex=Math.abs(Math.round(S/+w))+1)}},s=()=>{n("change",e.column[l.currIndex-1])},t=a=>{const{column:N}=e;let p=N.findIndex(S=>S[e.fieldNames.value]===e.value);l.currIndex=p===-1?1:p+1;let w=p===-1?0:p*+e.optionHeight;a&&s(),R(-w)},k=()=>{$.value=!1,h.value=0,s()};return q(()=>e.column,()=>{e.column&&e.column.length>0&&(l.transformY=0,t(!1))},{deep:!0}),q(()=>e.value,()=>{l.transformY=0,t(!1)},{deep:!0}),he(()=>{t(!0)}),fe(G(G({},te(l)),te(e)),{setRollerStyle:B,isHidden:f,isCurrPick:P,roller:c,onTouchStart:F,onTouchMove:o,onTouchEnd:y,touchRollerStyle:M,touchTileStyle:Y,setMove:R,stopMomentum:k,pxCheck:Me,maskStyles:O})}});function ze(e,n,m,l,c,$){return H(),L("view",{class:"nut-picker__list",onTouchstart:n[1]||(n[1]=(...r)=>e.onTouchStart&&e.onTouchStart(...r)),onTouchmove:n[2]||(n[2]=(...r)=>e.onTouchMove&&e.onTouchMove(...r)),onTouchend:n[3]||(n[3]=(...r)=>e.onTouchEnd&&e.onTouchEnd(...r))},[A("view",{ref:"roller",class:"nut-picker-roller",style:x(e.threeDimensional?e.touchRollerStyle:e.touchTileStyle),onTransitionend:n[0]||(n[0]=(...r)=>e.stopMomentum&&e.stopMomentum(...r))},[(H(!0),L(X,null,le(e.column,(r,h)=>{var g;return H(),L(X,{key:(g=r[e.fieldNames.value])!=null?g:h},[r&&r[e.fieldNames.text]&&e.threeDimensional?(H(),L("view",{key:0,class:oe(["nut-picker-roller-item",{"nut-picker-roller-item-hidden":e.isHidden(h+1),[r[e.fieldNames.className]]:r[e.fieldNames.className]}]),style:x(e.setRollerStyle(h+1))},j(r[e.fieldNames.text]),7)):W("",!0),r&&r[e.fieldNames.text]&&!e.threeDimensional?(H(),L("view",{key:1,class:oe(["nut-picker-roller-item-tile",{[r[e.fieldNames.className]]:r[e.fieldNames.className],"nut-picker-roller-item-selected":e.isCurrPick(h+1)}]),style:x({height:e.pxCheck(e.optionHeight),lineHeight:e.pxCheck(e.optionHeight)})},j(r[e.fieldNames.text]),7)):W("",!0)],64)}),128))],36),A("view",{class:"nut-picker-roller-mask",style:x(e.maskStyles)},null,4)],32)}const qe=de(Be,[["render",ze]]),xe={modelValue:{type:Array,default:()=>[]},title:{type:String,default:""},cancelText:{type:String,default:""},okText:{type:String,default:""},columns:{type:Array,default:()=>[]},threeDimensional:{type:Boolean,default:!1},swipeDuration:{type:[Number,String],default:1e3},showToolbar:{type:Boolean,default:!0},visibleOptionNum:{type:[Number,String],default:7},optionHeight:{type:[Number,String],default:36},fieldNames:{type:Object,default:()=>({})}},{create:Je}=pe("picker"),Ge="NutPicker",Ke=Je({components:{NutPickerColumn:qe},props:xe,emits:["cancel","change","confirm","update:modelValue"],setup(e,{emit:n}){const m=ge(Ge),{changeHandler:l,confirm:c,defaultValues:$,columnsList:r,columnsType:h,columnFieldNames:g,cancel:u}=Fe(e,n),D=C([]),M=O=>{O&&D.value.length<r.value.length&&D.value.push(O)},Y=U(()=>{const O={};return O.height=`${+e.visibleOptionNum*+e.optionHeight}px`,O["--lineHeight"]=`${+e.optionHeight}px`,O});return{columnsType:h,columnsList:r,columnFieldNames:g,cancel:u,changeHandler:l,confirmHandler:()=>{D.value.length>0&&D.value.forEach(O=>{O.stopMomentum()}),c()},defaultValues:$,translate:m,pickerColumn:D,swipeRef:M,columnStyle:Y}}}),Qe={class:"nut-picker"},We={key:0,class:"nut-picker__bar"},Xe={class:"nut-picker__title"};function Ze(e,n,m,l,c,$){const r=ye("nut-picker-column");return H(),L("div",Qe,[e.showToolbar?(H(),L("view",We,[A("view",{class:"nut-picker__left",onClick:n[0]||(n[0]=(...h)=>e.cancel&&e.cancel(...h))},j(e.cancelText||e.translate("cancel")),1),A("view",Xe,j(e.title),1),A("view",{class:"nut-picker__right",onClick:n[1]||(n[1]=(...h)=>e.confirmHandler&&e.confirmHandler(...h))},j(e.okText||e.translate("confirm")),1)])):W("",!0),ne(e.$slots,"top"),A("view",{class:"nut-picker__column",style:x(e.columnStyle)},[(H(!0),L(X,null,le(e.columnsList,(h,g)=>(H(),L("view",{key:g,class:"nut-picker__columnitem"},[i(r,{ref_for:!0,ref:e.swipeRef,column:h,"columns-type":e.columnsType,"field-names":e.columnFieldNames,value:e.defaultValues&&e.defaultValues[g],"three-dimensional":e.threeDimensional,"swipe-duration":e.swipeDuration,"visible-option-num":e.visibleOptionNum,"option-height":e.optionHeight,onChange:u=>{e.changeHandler(g,u)}},null,8,["column","columns-type","field-names","value","three-dimensional","swipe-duration","visible-option-num","option-height","onChange"])]))),128))],4),ne(e.$slots,"default")])}const et=de(Ke,[["render",Ze]]);const tt={class:"p-2 pb-[50px]"},lt={class:"p-[12px]"},nt={class:"pt-[18px] px-[20px]"},kt=ke({__name:"manage",setup(e){const n=Ne();n.getMenu();const m=J([{title:"菜名",key:"name",align:"center"},{title:"价格",key:"price",align:"center",sorter:(s,t)=>t.price-s.price},{title:"类型",key:"type",align:"center",render:s=>{var t;return(t=n.selectList.find(k=>k.value==s.type))==null?void 0:t.text}},{title:"操作",key:"render",align:"center",render:s=>Te(re,{onClick:()=>{Object.assign(u,s),M.value="edit",Y.value=s.isOnline?"1":"0",u.type=s.type+"",g.value=!0},size:"small",type:"primary"},()=>"修改")}]),l=C(!1),c=C("全部"),$=C(0),r=s=>{l.value=!1,c.value=s.selectedOptions[0].text,$.value=s.selectedOptions[0].value,n.getMenu(Number($.value))},h=C(null),g=C(!1),u=J({id:"",name:"",price:"",type:"1",picImg:"",isOnline:"",unit:"串"}),D=se(u),M=C("add"),Y=C("1"),B=()=>{h.value.validate().then(s=>{if(!s.valid)return;let t={...u,type:Number(u.type),price:Number(u.price),isOnline:Y.value=="1",picImg:u.picImg.includes("http")?"":u.picImg};M.value=="edit"&&ee.post("/updateMenu",t).then(()=>{Q.success("修改成功"),n.getMenu(Number($.value)),g.value=!1}),M.value=="add"&&ee.post("/addMenu",t).then(()=>{Q.success("添加成功"),n.getMenu(Number($.value)),g.value=!1})})},O=s=>{h.value.validate(s).then(()=>{})},F=s=>/^\d+(\.\d+)?$/.test(s)?Promise.resolve():Promise.reject("必须输入数字");q(()=>u.unit,s=>{console.log(s)});const o=s=>{u.picImg=JSON.parse(s.responseText).data,Q.success("上传成功")},y=J(se(n.selectList));y.unshift({text:"全部",value:0});const I=()=>{ee.post("/deleteMenu",{id:u.id}).then(()=>{Q.success("删除成功"),n.getMenu(Number($.value)),g.value=!1})},f=s=>new Promise(t=>{const k=new FileReader;k.onloadend=a=>t(a.target.result),k.readAsDataURL(s)}),P=s=>new Promise(t=>{const k=new Image;k.onload=()=>t(k),k.src=s}),T=(s,t,k)=>new Promise(a=>s.toBlob(N=>a(N),t,k)),R=async s=>{let t=s[0].name;const k=document.createElement("canvas"),a=k.getContext("2d"),N=await f(s[0]),p=await P(N);k.width=p.width,k.height=p.height,a.clearRect(0,0,p.width,p.height),a.drawImage(p,0,0,p.width,p.height);let w=await T(k,"image/jpeg",.5);return[await new File([w],t)]};return(s,t)=>{const k=He,a=et,N=we,p=Ve,w=re,S=Pe,_=_e,V=De,z=Oe,K=Se,ve=$e;return H(),L("div",tt,[i(k,{title:"请选择分类",desc:v(c),onClick:t[0]||(t[0]=b=>l.value=!0)},null,8,["desc"]),i(N,{position:"bottom",visible:v(l),"onUpdate:visible":t[2]||(t[2]=b=>Z(l)?l.value=b:null)},{default:d(()=>[i(a,{threeDimensional:"",columns:v(y),title:"请选择分类",onConfirm:r,onCancel:t[1]||(t[1]=b=>l.value=!1)},null,8,["columns"])]),_:1},8,["visible"]),i(p,{columns:v(m),data:v(n).productList},null,8,["columns","data"]),A("div",lt,[i(w,{block:"",type:"primary",onClick:t[3]||(t[3]=b=>{g.value=!0,M.value="add",Object.assign(v(u),v(D))})},{icon:d(()=>[i(v(Ce))]),default:d(()=>[t[13]||(t[13]=E(" 添加菜品 "))]),_:1})]),i(N,{position:"right",closeable:"","close-icon-position":"top-left",visible:v(g),"onUpdate:visible":t[12]||(t[12]=b=>Z(g)?g.value=b:null),style:{height:"100%",width:"100%"}},{default:d(()=>[A("div",nt,[i(ve,{"model-value":v(u),ref_key:"ruleForm",ref:h},{default:d(()=>[i(_,{label:"菜名",prop:"name",onBlur:t[5]||(t[5]=b=>O("name")),required:"",rules:[{required:!0,message:"请填写菜名"}]},{default:d(()=>[i(S,{class:"nut-input-text",rules:[{required:!0,message:"请填写菜名"}],modelValue:v(u).name,"onUpdate:modelValue":t[4]||(t[4]=b=>v(u).name=b),placeholder:"请填写要添加的菜名",type:"text"},null,8,["modelValue"])]),_:1}),i(_,{label:"价格",prop:"price",onBlur:t[7]||(t[7]=b=>O("price")),required:"",rules:[{required:!0,message:"请填写价格"},{validator:F,message:"必须输入数字"}]},{default:d(()=>[i(S,{class:"nut-input-text",modelValue:v(u).price,"onUpdate:modelValue":t[6]||(t[6]=b=>v(u).price=b),placeholder:"请输入单价",type:"text"},null,8,["modelValue"])]),_:1},8,["rules"]),i(_,{label:"单位",prop:"unit"},{default:d(()=>[i(z,{direction:"horizontal",modelValue:v(u).unit,"onUpdate:modelValue":t[8]||(t[8]=b=>v(u).unit=b)},{default:d(()=>[i(V,{label:"串"},{default:d(()=>t[14]||(t[14]=[E("串")])),_:1}),i(V,{label:"份"},{default:d(()=>t[15]||(t[15]=[E("份")])),_:1}),i(V,{label:"瓶"},{default:d(()=>t[16]||(t[16]=[E("瓶")])),_:1}),i(V,{label:"件"},{default:d(()=>t[17]||(t[17]=[E("件")])),_:1}),i(V,{label:"个"},{default:d(()=>t[18]||(t[18]=[E("个")])),_:1})]),_:1},8,["modelValue"])]),_:1}),i(_,{label:"是否上架",prop:"isOnline"},{default:d(()=>[i(z,{direction:"horizontal",modelValue:v(Y),"onUpdate:modelValue":t[9]||(t[9]=b=>Z(Y)?Y.value=b:null)},{default:d(()=>[i(V,{label:"1"},{default:d(()=>t[19]||(t[19]=[E("上架")])),_:1}),i(V,{label:"0"},{default:d(()=>t[20]||(t[20]=[E("下架")])),_:1})]),_:1},8,["modelValue"])]),_:1}),i(_,{label:"所属分类",prop:"type"},{default:d(()=>[i(z,{direction:"horizontal",modelValue:v(u).type,"onUpdate:modelValue":t[10]||(t[10]=b=>v(u).type=b)},{default:d(()=>[(H(!0),L(X,null,le(v(n).selectList,b=>(H(),ue(V,{label:b.value,key:b.value},{default:d(()=>[E(j(b.text),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(_,{label:"预览图片上传",prop:"picImg"},{default:d(()=>[i(K,{url:"/api/upload",accept:"image/*",modelValue:v(u).picImg,"onUpdate:modelValue":t[11]||(t[11]=b=>v(u).picImg=b),onSuccess:o,"before-upload":R,name:"image"},null,8,["modelValue"])]),_:1}),i(k,null,{default:d(()=>[i(w,{block:"",type:"primary",onClick:B},{icon:d(()=>[i(ie,{icon:v(M)=="edit"?"mdi:circle-edit-outline":"ion:plus"},null,8,["icon"])]),default:d(()=>[E("确认"+j(v(M)=="edit"?"修改":"添加")+" ",1)]),_:1})]),_:1}),i(k,null,{default:d(()=>[v(M)=="edit"?(H(),ue(w,{key:0,block:"",type:"warning",onClick:I},{icon:d(()=>[i(ie,{icon:"ion:trash-outline"})]),default:d(()=>[t[21]||(t[21]=E(" 删 除 "))]),_:1})):W("",!0)]),_:1})]),_:1},8,["model-value"])])]),_:1},8,["visible"])])}}});export{kt as default};
