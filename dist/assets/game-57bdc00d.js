import{I as te,J as ie,o as s,e as d,m as q,n as re,f as n,d as ue,aK as de,r as g,V as ce,t as i,v as r,F as $,C as D,u as c,x as V,y as O,_ as fe,D as ve,N as ge,A as p,a9 as pe,aj as _e,G as u,l as M,h as L,Y as Pe}from"./index-1a998e25.js";/* empty css              */import{_ as ye}from"./index-9120f2a1.js";import{_ as be,a as me}from"./index-6824c424.js";import{_ as Me}from"./index-fad7d05d.js";/* empty css              */import"./common-BH7uB7Cn-929e3022.js";import"./CheckNormal-a7c26b17.js";import"./pxCheck-DN6FYV6q-3938f682.js";import"./Plus-ddd558e3.js";const Ve=ie("close-little"),ke=n("path",{d:"M998.002 26a85.073 85.073 0 0 0-120.415 0L451.795 451.792a85.073 85.073 0 1 0 120.414 120.415l425.793-425.793a85.073 85.073 0 0 0 0-120.414zM877.587 998a85.073 85.073 0 1 0 120.415-120.415L146.416 26A85.073 85.073 0 1 0 26.002 146.414L391.588 512 26.002 877.585A85.073 85.073 0 1 0 146.416 998l365.586-365.585 365.585 365.585z",fill:"currentColor","fill-opacity":"0.9"},null,-1),Se=[ke];function Ze(T,f,_,C,h,E){return s(),d("svg",{class:q(T.classes),style:re(T.style),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1026 1024",role:"presentation"},Se,6)}const we=te(Ve,[["render",Ze]]),Ce={class:"game-container"},Ne={class:"header-buttons"},he={class:"player-grid"},Be={class:"player-info"},Fe={class:"rank"},ze={class:"game-info"},xe={class:"score-section"},Ue={class:"win-type"},$e={key:0,class:"fangpao-name"},De={class:"popup-header"},Ie={class:"close-icon"},Te={class:"result-list"},Ee={class:"result-header-row"},Le={class:"result-left"},je={class:"player-name"},Ae={key:0,class:"result-tags"},Re={class:"tag win-type-tag"},Oe={class:"tag score-tag"},qe={class:"detail"},Ge={key:0},Je={key:0,class:"detail-players"},Ke={key:1},Ye={key:0,class:"detail-players"},He={key:2},Qe={key:0,class:"detail-players"},We={key:3},Xe={key:0,class:"detail-players"},ea=ue({__name:"game",setup(T){const f=de("initPlayer",[]),_=g([]);ce(()=>{_.value=f.value.map((o,a)=>(console.log(o.id,a),{index:a,id:"",score:0,name:"",fuZi:0,fangPao:"",fangPaoName:"",isZiMo:!0}))});const C=g(!1),h=g(""),E=g(!1),j=g(""),G=()=>{E.value=!1,j.value=""},J=()=>{C.value=!0,h.value=""},K=()=>{const o=Date.now();f.value.push({id:o,name:h.value.trim(),score:0}),C.value=!1},B=g(!1),b=g(),Y=()=>{if(f.value.length<=1){O.fail("至少保留一名玩家");return}B.value=!0,b.value=void 0},H=()=>{if(!b.value){O.fail("请选择要删除的玩家");return}const o=f.value.findIndex(a=>a.id===b.value);o!==-1&&(f.value.splice(o,1),B.value=!1)},Q=()=>{_.value=f.value.map((o,a)=>(console.log(o.id,a),{index:a,id:"",score:0,name:"",fuZi:0,fangPao:"",fangPaoName:"",isZiMo:!0}))},F=g(!1),z=g(),W=o=>{F.value=!0,z.value=_.value.findIndex(a=>a.id===o)},X=()=>{if(!b.value||z.value===void 0)return;const o=f.value.find(a=>a.id===b.value);o&&z.value!==void 0&&(_.value[z.value]={..._.value[z.value],id:o.id,name:o.name}),F.value=!1,b.value=void 0},ee=o=>_.value.some(a=>a.id===o&&z.value!==_.value.findIndex(v=>v.id===o)),x=g(!1),N=g(),k=g(null),ae=o=>{k.value=o,x.value=!0,N.value=o.fangPao||void 0},oe=()=>{if(!N.value||!k.value)return;const o=f.value.find(a=>a.id===N.value);o&&(k.value.fangPao=o.id,k.value.fangPaoName=o.name),x.value=!1,N.value=void 0,k.value=null},le=o=>{o.isZiMo?(o.fangPao="",o.fangPaoName=""):ae(o)},U=g(!1),S=g([]),se=()=>{S.value=f.value.map(o=>({id:o.id,name:o.name,ziMoScore:0,beiFangPaoScore:0,beiFangPaoByPlayers:[],fangPaoScore:0,beiZiMoScore:0,ziMoPlayers:[],beiZiMoByPlayers:[],fangPaoToPlayers:[],total:0,order:-1,isZiMo:!1,score:0})),_.value.forEach((o,a)=>{if(!o.id||!o.score)return;const v=Number(o.score);if(isNaN(v))return;const Z=S.value.find(t=>t.id===o.id);if(Z&&(Z.order=a,Z.isZiMo=o.isZiMo,Z.score=o.score),o.isZiMo){const t=S.value.find(P=>P.id===o.id);if(t){const P=f.value.filter(l=>l.id!==o.id&&!_.value.slice(0,a).some(m=>m.id===l.id)),y=v*2*P.length;t.ziMoScore+=y,t.total+=y,t.ziMoPlayers=P.map(l=>l.name),S.value.forEach(l=>{if(P.some(m=>m.id===l.id)){const m=v*2;l.beiZiMoScore-=m,l.total-=m,l.beiZiMoByPlayers||(l.beiZiMoByPlayers=[]),l.beiZiMoByPlayers.push(t.name)}})}}else if(!o.isZiMo&&o.fangPao){const t=Number(o.score),P=Number(o.fangPao);if(isNaN(P)||isNaN(t))return;const y=S.value.find(m=>m.id===o.id),l=S.value.find(m=>m.id===P);y&&l&&(y.beiFangPaoScore+=t,y.total+=t,y.beiFangPaoByPlayers||(y.beiFangPaoByPlayers=[]),y.beiFangPaoByPlayers.push(l.name)),l&&(l.fangPaoScore-=t,l.total-=t,l.fangPaoToPlayers||(l.fangPaoToPlayers=[]),y&&l.fangPaoToPlayers.push(y.name))}}),S.value.sort((o,a)=>o.order===-1&&a.order===-1?0:o.order===-1?1:a.order===-1?-1:o.order-a.order),U.value=!0},ne=o=>{if(!k.value||o===k.value.id)return!0;const a=k.value.index;return _.value.some((v,Z)=>Z<a&&v.id===o&&v.id!=="")};return(o,a)=>{const v=fe,Z=Me,t=be,P=me,y=ye,l=ve,m=ge;return s(),d("div",Ce,[n("div",Ne,[i(v,{type:"primary",onClick:J},{default:r(()=>a[14]||(a[14]=[p("添加玩家")])),_:1}),i(v,{type:"danger",onClick:Y},{default:r(()=>a[15]||(a[15]=[p("删除玩家")])),_:1}),i(v,{type:"danger",onClick:se},{default:r(()=>a[16]||(a[16]=[p("计算结果")])),_:1}),i(v,{type:"warning",onClick:Q},{default:r(()=>a[17]||(a[17]=[p("重置数据")])),_:1})]),n("div",he,[(s(!0),d($,null,D(c(_),(e,I)=>pe((s(),d("div",{key:e.id,class:"player-item"},[n("div",Be,[n("span",Fe,"第"+u(e.index+1)+"名 ",1),i(v,{size:"small",onClick:w=>W(e.id)},{default:r(()=>[p(u(e.name?e.name:"请选择"),1)]),_:2},1032,["onClick"])]),n("div",ze,[n("div",xe,[a[18]||(a[18]=n("span",{class:"label"},"符子:",-1)),i(Z,{"button-size":30,"input-width":40,modelValue:e.score,"onUpdate:modelValue":w=>e.score=w,step:1,min:1,max:24},null,8,["modelValue","onUpdate:modelValue"])]),n("div",Ue,[i(P,{modelValue:e.isZiMo,"onUpdate:modelValue":w=>e.isZiMo=w,onChange:w=>le(e)},{default:r(()=>[i(t,{label:!0},{default:r(()=>a[19]||(a[19]=[p("自摸")])),_:1}),i(t,{label:!1},{default:r(()=>a[20]||(a[20]=[p("被放炮")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),e.isZiMo?M("",!0):(s(),d("span",$e,u(e.fangPaoName?`放炮: ${e.fangPaoName}`:"未选择放炮"),1))])])])),[[_e,I<c(_).length-1]])),128))]),i(l,{visible:c(C),"onUpdate:visible":a[1]||(a[1]=e=>V(C)?C.value=e:null),title:"添加玩家",onOk:K,onCancel:a[2]||(a[2]=e=>C.value=!1),class:"custom-dialog"},{default:r(()=>[i(y,{modelValue:c(h),"onUpdate:modelValue":a[0]||(a[0]=e=>V(h)?h.value=e:null),placeholder:"请输入玩家名称",required:"",error:c(E),"error-message":c(j),onInput:G},null,8,["modelValue","error","error-message"])]),_:1},8,["visible"]),i(l,{visible:c(B),"onUpdate:visible":a[4]||(a[4]=e=>V(B)?B.value=e:null),title:"删除玩家",onOk:H,onCancel:a[5]||(a[5]=e=>B.value=!1),class:"custom-dialog"},{default:r(()=>[i(P,{modelValue:c(b),"onUpdate:modelValue":a[3]||(a[3]=e=>V(b)?b.value=e:null)},{default:r(()=>[(s(!0),d($,null,D(c(f),e=>(s(),L(t,{key:e.id,label:e.id},{default:r(()=>[p(u(e.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["visible"]),i(l,{visible:c(F),"onUpdate:visible":a[7]||(a[7]=e=>V(F)?F.value=e:null),title:"选择玩家",footer:!1,onCancel:a[8]||(a[8]=e=>F.value=!1),class:"custom-dialog"},{default:r(()=>[i(P,{modelValue:c(b),"onUpdate:modelValue":a[6]||(a[6]=e=>V(b)?b.value=e:null),onChange:X},{default:r(()=>[(s(!0),d($,null,D(c(f),e=>(s(),L(t,{key:e.id,label:e.id,disabled:ee(e.id)},{default:r(()=>[p(u(e.name),1)]),_:2},1032,["label","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["visible"]),i(l,{visible:c(x),"onUpdate:visible":a[10]||(a[10]=e=>V(x)?x.value=e:null),title:"选择放炮玩家",footer:!1,onCancel:a[11]||(a[11]=e=>x.value=!1),class:"custom-dialog"},{default:r(()=>[i(P,{modelValue:c(N),"onUpdate:modelValue":a[9]||(a[9]=e=>V(N)?N.value=e:null),onChange:oe},{default:r(()=>[(s(!0),d($,null,D(c(f),e=>(s(),L(t,{key:e.id,label:e.id,disabled:ne(e.id)},{default:r(()=>[p(u(e.name),1)]),_:2},1032,["label","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["visible"]),i(m,{visible:c(U),"onUpdate:visible":a[13]||(a[13]=e=>V(U)?U.value=e:null),position:"bottom",class:"result-popup"},{default:r(()=>[n("div",De,[a[21]||(a[21]=n("div",{class:"result-header"},"计算结果",-1)),n("div",Ie,[i(c(we),{onClick:a[12]||(a[12]=e=>U.value=!1)})])]),n("div",Te,[(s(!0),d($,null,D(c(S),e=>{var I,w,A,R;return s(),d("div",{key:e.id,class:"result-item"},[n("div",Ee,[n("div",Le,[n("span",je,u(e.name),1),n("span",{class:q(["score",e.total>=0?"win":"lose"])},u(e.total>=0?"+":"")+u(e.total),3)]),e.order>-1?(s(),d("div",Ae,[n("span",Re,u(e.isZiMo?"自摸":"被放炮"),1),n("span",Oe,u(e.score)+"符",1)])):M("",!0)]),n("div",qe,[e.ziMoScore?(s(),d("div",Ge,[p(" 自摸得分：+"+u(e.ziMoScore)+" ",1),(I=e.ziMoPlayers)!=null&&I.length?(s(),d("span",Je," ("+u(e.ziMoPlayers.join("、"))+") ",1)):M("",!0)])):M("",!0),e.beiFangPaoScore?(s(),d("div",Ke,[p(" 被放炮得分：+"+u(e.beiFangPaoScore)+" ",1),(w=e.beiFangPaoByPlayers)!=null&&w.length?(s(),d("span",Ye," ("+u(e.beiFangPaoByPlayers.join("、"))+") ",1)):M("",!0)])):M("",!0),e.fangPaoScore?(s(),d("div",He,[p(" 放炮失分："+u(e.fangPaoScore)+" ",1),(A=e.fangPaoToPlayers)!=null&&A.length?(s(),d("span",Qe," ("+u(e.fangPaoToPlayers.join("、"))+") ",1)):M("",!0)])):M("",!0),e.beiZiMoScore?(s(),d("div",We,[p(" 被自摸失分："+u(e.beiZiMoScore)+" ",1),(R=e.beiZiMoByPlayers)!=null&&R.length?(s(),d("span",Xe," ("+u(e.beiZiMoByPlayers.join("、"))+") ",1)):M("",!0)])):M("",!0)])])}),128))])]),_:1},8,["visible"])])}}});const ca=Pe(ea,[["__scopeId","data-v-b6134615"]]);export{ca as default};
