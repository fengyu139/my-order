import{a as J,r as V,c as R,w as z,Q as ve,L as ee,_ as ce,b as de,M as he,h as ge,o as M,d as L,e as U,H as j,k as K,f as le,F as W,C as te,s as u,n as q,a1 as ne,l as ye,a2 as be,m as ke,q as we,a3 as ae,v as f,t as m,x as X,O as _e,N as oe,V as Ne,A as E,j as se,a4 as re,z as Z,y as G}from"./index-9e4b392f.js";import{N as Te,a as Se}from"./index-742e45d2.js";import{i as $e}from"./index-fe620a35.js";import{_ as De,a as Oe}from"./index-b5e328af.js";import{i as Ve}from"./index-7fee005b.js";/* empty css              */import{i as Ce}from"./index-f3089d0b.js";/* empty css              */import{w as Pe}from"./Plus-ee977bed.js";import{p as Me,N as Ie}from"./Cell-fd0a5155.js";import{u as He}from"./index-084nl_oE-93555df5.js";import"./Checked-05d3342e.js";import"./CheckNormal-39a22432.js";var Ye=Object.defineProperty,Ee=Object.defineProperties,Le=Object.getOwnPropertyDescriptors,ue=Object.getOwnPropertySymbols,Re=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable,ie=(e,a,c)=>a in e?Ye(e,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):e[a]=c,Q=(e,a)=>{for(var c in a||(a={}))Re.call(a,c)&&ie(e,c,a[c]);if(ue)for(var c of ue(a))Ue.call(a,c)&&ie(e,c,a[c]);return e},me=(e,a)=>Ee(e,Le(a));const Fe={text:"text",value:"value",children:"children"},Ae=(e,a)=>{const c=J({formattedColumns:e.columns}),t=R(()=>Q(Q({},Fe),e.fieldNames)),i=V([]),T=R(()=>{const o=t.value;return $.value.map((h,P)=>{const p=h.findIndex(S=>S[o.value]===i.value[P]);return p===-1?0:p})}),d=V([]),k=o=>{o&&d.value.length<$.value.length&&d.value.push(o)},v=R(()=>{const o=t.value;return $.value.map((h,P)=>h.find(p=>p[o.value]===i.value[P])||h[0])}),r=R(()=>{const o=c.formattedColumns[0],h=t.value;if(o){if(Array.isArray(o))return"multiple";if(h.children in o)return"cascade"}return"single"}),$=R(()=>{let o=[];switch(r.value){case"multiple":o=c.formattedColumns;break;case"cascade":o=C(c.formattedColumns,i.value?i.value:[]);break;default:o=[c.formattedColumns];break}return o}),C=(o,h)=>{const P=[],p=t.value;let S={text:"",value:"",[p.children]:o},_=0;for(;S&&S[p.children];){const A=S[p.children],s=h[_];let n=A.findIndex(l=>l[p.value]===s);n===-1&&(n=0),S=S[p.children][n],_++,P.push(A)}return P},H=()=>{a("cancel",{selectedValue:i.value,selectedOptions:v.value})},B=(o,h)=>{var P;const p=t.value;if(h&&Object.keys(h).length){if(i.value=i.value?i.value:[],r.value==="cascade"){i.value[o]=(P=h[p.value])!=null?P:"";let S=o,_=h;for(;_&&_[p.children]&&_[p.children][0];)i.value[S+1]=_[p.children][0][p.value],S++,_=_[p.children][0];_&&_[p.children]&&_[p.children].length===0&&(i.value=i.value.slice(0,S+1))}else i.value[o]=Object.prototype.hasOwnProperty.call(h,p.value)?h[p.value]:"";a("change",{columnIndex:o,selectedValue:i.value,selectedOptions:v.value})}},D=()=>{const o=t.value;i.value&&!i.value.length&&$.value.forEach(h=>{i.value.push(h[0][o.value])}),a("confirm",{selectedValue:i.value,selectedOptions:v.value})},F=(o,h)=>JSON.stringify(o)===JSON.stringify(h);return z(()=>e.modelValue,o=>{F(o,i.value)||(i.value=o)},{deep:!0,immediate:!0}),z(i,o=>{F(o,e.modelValue)||a("update:modelValue",o)},{deep:!0}),z(()=>e.columns,o=>{c.formattedColumns=o}),me(Q({},ee(c)),{columnsType:r,columnsList:$,columnFieldNames:t,cancel:H,changeHandler:B,confirm:D,defaultValues:i,defaultIndexes:T,pickerColumn:d,swipeRef:k,selectedOptions:v,isSameValue:F})},{create:je}=de("picker-column"),Be=je({props:{value:[String,Number],columnsType:String,column:{type:Array,default:()=>[]},threeDimensional:{type:Boolean,default:!0},swipeDuration:{type:[Number,String],default:1e3},visibleOptionNum:{type:[Number,String],default:7},optionHeight:{type:[Number,String],default:36},fieldNames:{type:Object,default:()=>({})},taro:{type:Boolean,defualt:!1}},emits:["click","change"],setup(e,{emit:a}){const c=He(),t=J({touchParams:{startY:0,endY:0,startTime:0,endTime:0,lastY:0,lastTime:0},currIndex:1,transformY:0,scrollDistance:0,rotation:20}),i=V(null),T=V(!1),d=V(0),k=V(0),v=200,r=300,$=15,C=R(()=>({transition:`transform ${k.value}ms cubic-bezier(0.17, 0.89, 0.45, 1)`,transform:`rotate3d(1, 0, 0, ${d.value})`,top:`calc(50% - ${+e.optionHeight/2}px)`})),H=R(()=>{const{optionHeight:l}=e;return{transition:`transform ${k.value}ms cubic-bezier(0.17, 0.89, 0.45, 1)`,transform:`translate3d(0, ${t.scrollDistance}px, 0)`,top:`calc(50% - ${+l/2}px)`,height:`${l}px`}}),B=l=>`transform: rotate3d(1, 0, 0, ${-t.rotation*l}deg) translate3d(0px, 0px, 104px)`,D=R(()=>({backgroundSize:`100% ${(+e.visibleOptionNum-1)*+e.optionHeight/2}px`})),F=l=>{if(c.start(l),T.value&&!e.taro){const g=i.value,{transform:w}=window.getComputedStyle(g);if(e.threeDimensional){const y=Math.floor(parseInt(d.value)/360),N=+w.split(", ")[5],O=+w.split(", ")[6]<0?180:0,I=y*360+Math.acos(N)/Math.PI*180+O;t.scrollDistance=-Math.abs((I/t.rotation-1)*+e.optionHeight)}else t.scrollDistance=+w.slice(7,w.length-1).split(", ")[5]}ne(l,!0),t.touchParams.startY=c.deltaY.value,t.touchParams.startTime=Date.now(),t.transformY=t.scrollDistance},o=l=>{c.move(l),c.isVertical()&&(T.value=!0,ne(l,!0)),t.touchParams.lastY=c.deltaY.value;let g=t.touchParams.lastY-t.touchParams.startY;_(g)},h=()=>{t.touchParams.lastY=c.deltaY.value,t.touchParams.lastTime=Date.now();let l=t.touchParams.lastY-t.touchParams.startY,g=t.touchParams.lastTime-t.touchParams.startTime;if(g<=r&&Math.abs(l)>$){const w=P(l,g);_(w,"end",+e.swipeDuration);return}else _(l,"end");setTimeout(()=>{c.reset(),T.value=!1},0)},P=(l,g)=>(l=Math.abs(l/g)/.003*(l<0?-1:1),l),p=l=>l>=t.currIndex+8||l<=t.currIndex-8,S=(l=0,g,w=v,y)=>{g==="end"?k.value=w:k.value=0,d.value=y,t.scrollDistance=l},_=(l,g,w)=>{const{optionHeight:y}=e;let N=l+t.transformY;if(g==="end"){N>0&&(N=0),N<-(e.column.length-1)*+y&&(N=-(e.column.length-1)*+y);let O=Math.round(N/+y)*+y,I=`${(Math.abs(Math.round(O/+y))+1)*t.rotation}deg`;S(O,g,w,I),t.currIndex=Math.abs(Math.round(O/+y))+1}else{let O=0,I=(-N/+y+1)*t.rotation;const Y=(e.column.length+1)*t.rotation,x=0;O=be(I,x,Y),x<O&&O<Y&&(S(N,null,void 0,O+"deg"),t.currIndex=Math.abs(Math.round(N/+y))+1)}},A=()=>{a("change",e.column[t.currIndex-1])},s=l=>{const{column:g}=e;let w=g.findIndex(N=>N[e.fieldNames.value]===e.value);t.currIndex=w===-1?1:w+1;let y=w===-1?0:w*+e.optionHeight;l&&A(),_(-y)},n=()=>{T.value=!1,k.value=0,A()};return z(()=>e.column,()=>{e.column&&e.column.length>0&&(t.transformY=0,s(!1))},{deep:!0}),z(()=>e.value,()=>{t.transformY=0,s(!1)},{deep:!0}),ve(()=>{s(!0)}),me(Q(Q({},ee(t)),ee(e)),{setRollerStyle:B,isHidden:p,roller:i,onTouchStart:F,onTouchMove:o,onTouchEnd:h,touchRollerStyle:C,touchTileStyle:H,setMove:_,stopMomentum:n,pxCheck:Me,maskStyles:D})}});function xe(e,a,c,t,i,T){return M(),L("view",{class:"nut-picker__list",onTouchstart:a[1]||(a[1]=(...d)=>e.onTouchStart&&e.onTouchStart(...d)),onTouchmove:a[2]||(a[2]=(...d)=>e.onTouchMove&&e.onTouchMove(...d)),onTouchend:a[3]||(a[3]=(...d)=>e.onTouchEnd&&e.onTouchEnd(...d))},[U("view",{ref:"roller",class:"nut-picker-roller",style:q(e.threeDimensional?e.touchRollerStyle:e.touchTileStyle),onTransitionend:a[0]||(a[0]=(...d)=>e.stopMomentum&&e.stopMomentum(...d))},[(M(!0),L(W,null,te(e.column,(d,k)=>{var v;return M(),L(W,{key:(v=d[e.fieldNames.value])!=null?v:k},[d&&d[e.fieldNames.text]&&e.threeDimensional?(M(),L("view",{key:0,class:ye(["nut-picker-roller-item",{"nut-picker-roller-item-hidden":e.isHidden(k+1)}]),style:q(e.setRollerStyle(k+1))},j(d[e.fieldNames.text]),7)):K("",!0),d&&d[e.fieldNames.text]&&!e.threeDimensional?(M(),L("view",{key:1,class:"nut-picker-roller-item-tile",style:q({height:e.pxCheck(e.optionHeight),lineHeight:e.pxCheck(e.optionHeight)})},j(d[e.fieldNames.text]),5)):K("",!0)],64)}),128))],36),U("view",{class:"nut-picker-roller-mask",style:q(e.maskStyles)},null,4)],32)}const ze=ce(Be,[["render",xe]]),qe={modelValue:{type:Array,default:()=>[]},title:{type:String,default:""},cancelText:{type:String,default:""},okText:{type:String,default:""},columns:{type:Array,default:()=>[]},threeDimensional:{type:Boolean,default:!1},swipeDuration:{type:[Number,String],default:1e3},showToolbar:{type:Boolean,default:!0},visibleOptionNum:{type:[Number,String],default:7},optionHeight:{type:[Number,String],default:36},fieldNames:{type:Object,default:()=>({})}},{create:Je}=de("picker"),Qe="NutPicker",Ge=Je({components:{NutPickerColumn:ze},props:qe,emits:["cancel","change","confirm","update:modelValue"],setup(e,{emit:a}){const c=he(Qe),{changeHandler:t,confirm:i,defaultValues:T,columnsList:d,columnsType:k,columnFieldNames:v,cancel:r}=Ae(e,a),$=V([]),C=D=>{D&&$.value.length<d.value.length&&$.value.push(D)},H=R(()=>{const D={};return D.height=`${+e.visibleOptionNum*+e.optionHeight}px`,D["--lineHeight"]=`${+e.optionHeight}px`,D});return{columnsType:k,columnsList:d,columnFieldNames:v,cancel:r,changeHandler:t,confirmHandler:()=>{$.value.length>0&&$.value.forEach(D=>{D.stopMomentum()}),i()},defaultValues:T,translate:c,pickerColumn:$,swipeRef:C,columnStyle:H}}}),Ke={class:"nut-picker"},We={key:0,class:"nut-picker__bar"},Xe={class:"nut-picker__title"};function Ze(e,a,c,t,i,T){const d=ge("nut-picker-column");return M(),L("div",Ke,[e.showToolbar?(M(),L("view",We,[U("view",{class:"nut-picker__left",onClick:a[0]||(a[0]=(...k)=>e.cancel&&e.cancel(...k))},j(e.cancelText||e.translate("cancel")),1),U("view",Xe,j(e.title),1),U("view",{class:"nut-picker__right",onClick:a[1]||(a[1]=(...k)=>e.confirmHandler&&e.confirmHandler(...k))},j(e.okText||e.translate("confirm")),1)])):K("",!0),le(e.$slots,"top"),U("view",{class:"nut-picker__column",style:q(e.columnStyle)},[(M(!0),L(W,null,te(e.columnsList,(k,v)=>(M(),L("view",{key:v,class:"nut-picker__columnitem"},[u(d,{ref_for:!0,ref:e.swipeRef,column:k,"columns-type":e.columnsType,"field-names":e.columnFieldNames,value:e.defaultValues&&e.defaultValues[v],"three-dimensional":e.threeDimensional,"swipe-duration":e.swipeDuration,"visible-option-num":e.visibleOptionNum,"option-height":e.optionHeight,onChange:r=>{e.changeHandler(v,r)}},null,8,["column","columns-type","field-names","value","three-dimensional","swipe-duration","visible-option-num","option-height","onChange"])]))),128))],4),le(e.$slots,"default")])}const et=ce(Ge,[["render",Ze]]);const tt={class:"p-2 pb-[50px]"},lt={class:"p-[12px]"},nt={class:"pt-[18px] px-[20px]"},gt=ke({__name:"manage",setup(e){const a=we();a.getMenu();const c=J([{title:"菜名",key:"name",align:"center"},{title:"价格",key:"price",align:"center",sorter:(s,n)=>n.price-s.price},{title:"类型",key:"type",align:"center",render:s=>{var n;return(n=a.selectList.find(l=>l.value==s.type))==null?void 0:n.text}},{title:"操作",key:"render",align:"center",render:s=>Ne(oe,{onClick:()=>{Object.assign(r,s),C.value="edit",H.value=s.isOnline?"1":"0",r.type=s.type+"",v.value=!0},size:"small",type:"primary"},()=>"修改")}]),t=V(!1),i=V("全部"),T=V(0),d=s=>{t.value=!1,i.value=s.selectedOptions[0].text,T.value=s.selectedOptions[0].value,a.getMenu(Number(T.value))},k=V(null),v=V(!1),r=J({id:"",name:"",price:"",type:"1",picImg:"",isOnline:"",unit:"串"}),$=ae(r),C=V("add"),H=V("1"),B=()=>{k.value.validate().then(s=>{if(!s.valid)return;let n={...r,type:Number(r.type),price:Number(r.price),isOnline:H.value=="1",picImg:r.picImg.includes("http")?"":r.picImg};C.value=="edit"&&Z.post("/updateMenu",n).then(()=>{G.success("修改成功"),a.getMenu(Number(T.value)),v.value=!1}),C.value=="add"&&Z.post("/addMenu",n).then(()=>{G.success("添加成功"),a.getMenu(Number(T.value)),v.value=!1})})},D=s=>{k.value.validate(s).then(()=>{})},F=s=>/^\d+(\.\d+)?$/.test(s)?Promise.resolve():Promise.reject("必须输入数字");z(()=>r.unit,s=>{console.log(s)});const o=s=>{r.picImg=JSON.parse(s.responseText).data,G.success("上传成功")},h=J(ae(a.selectList));h.unshift({text:"全部",value:0});const P=()=>{Z.post("/deleteMenu",{id:r.id}).then(()=>{G.success("删除成功"),a.getMenu(Number(T.value)),v.value=!1})},p=s=>new Promise(n=>{const l=new FileReader;l.onloadend=g=>n(g.target.result),l.readAsDataURL(s)}),S=s=>new Promise(n=>{const l=new Image;l.onload=()=>n(l),l.src=s}),_=(s,n,l)=>new Promise(g=>s.toBlob(w=>g(w),n,l)),A=async s=>{let n=s[0].name;const l=document.createElement("canvas"),g=l.getContext("2d"),w=await p(s[0]),y=await S(w);l.width=y.width,l.height=y.height,g.clearRect(0,0,y.width,y.height),g.drawImage(y,0,0,y.width,y.height);let N=await _(l,"image/jpeg",.5);return[await new File([N],n)]};return(s,n)=>{const l=Ie,g=et,w=_e,y=Ce,N=oe,O=Ve,I=Te,Y=De,x=Oe,pe=$e,fe=Se;return M(),L("div",tt,[u(l,{title:"请选择分类",desc:f(i),onClick:n[0]||(n[0]=b=>t.value=!0)},null,8,["desc"]),u(w,{position:"bottom",visible:f(t),"onUpdate:visible":n[2]||(n[2]=b=>X(t)?t.value=b:null)},{default:m(()=>[u(g,{threeDimensional:"",columns:f(h),title:"请选择分类",onConfirm:d,onCancel:n[1]||(n[1]=b=>t.value=!1)},null,8,["columns"])]),_:1},8,["visible"]),u(y,{columns:f(c),data:f(a).productList},null,8,["columns","data"]),U("div",lt,[u(N,{block:"",type:"primary",onClick:n[3]||(n[3]=b=>{v.value=!0,C.value="add",Object.assign(f(r),f($))})},{icon:m(()=>[u(f(Pe))]),default:m(()=>[E(" 添加菜品 ")]),_:1})]),u(w,{position:"right",closeable:"","close-icon-position":"top-left",visible:f(v),"onUpdate:visible":n[12]||(n[12]=b=>X(v)?v.value=b:null),style:{height:"100%",width:"100%"}},{default:m(()=>[U("div",nt,[u(fe,{"model-value":f(r),ref_key:"ruleForm",ref:k},{default:m(()=>[u(I,{label:"菜名",prop:"name",onBlur:n[5]||(n[5]=b=>D("name")),required:"",rules:[{required:!0,message:"请填写菜名"}]},{default:m(()=>[u(O,{class:"nut-input-text",rules:[{required:!0,message:"请填写菜名"}],modelValue:f(r).name,"onUpdate:modelValue":n[4]||(n[4]=b=>f(r).name=b),placeholder:"请填写要添加的菜名",type:"text"},null,8,["modelValue"])]),_:1}),u(I,{label:"价格",prop:"price",onBlur:n[7]||(n[7]=b=>D("price")),required:"",rules:[{required:!0,message:"请填写价格"},{validator:F,message:"必须输入数字"}]},{default:m(()=>[u(O,{class:"nut-input-text",modelValue:f(r).price,"onUpdate:modelValue":n[6]||(n[6]=b=>f(r).price=b),placeholder:"请输入单价",type:"text"},null,8,["modelValue"])]),_:1},8,["rules"]),u(I,{label:"单位",prop:"unit"},{default:m(()=>[u(x,{direction:"horizontal",modelValue:f(r).unit,"onUpdate:modelValue":n[8]||(n[8]=b=>f(r).unit=b)},{default:m(()=>[u(Y,{label:"串"},{default:m(()=>[E("串")]),_:1}),u(Y,{label:"份"},{default:m(()=>[E("份")]),_:1}),u(Y,{label:"瓶"},{default:m(()=>[E("瓶")]),_:1}),u(Y,{label:"件"},{default:m(()=>[E("件")]),_:1}),u(Y,{label:"个"},{default:m(()=>[E("个")]),_:1})]),_:1},8,["modelValue"])]),_:1}),u(I,{label:"是否上架",prop:"isOnline"},{default:m(()=>[u(x,{direction:"horizontal",modelValue:f(H),"onUpdate:modelValue":n[9]||(n[9]=b=>X(H)?H.value=b:null)},{default:m(()=>[u(Y,{label:"1"},{default:m(()=>[E("上架")]),_:1}),u(Y,{label:"0"},{default:m(()=>[E("下架")]),_:1})]),_:1},8,["modelValue"])]),_:1}),u(I,{label:"所属分类",prop:"type"},{default:m(()=>[u(x,{direction:"horizontal",modelValue:f(r).type,"onUpdate:modelValue":n[10]||(n[10]=b=>f(r).type=b)},{default:m(()=>[(M(!0),L(W,null,te(f(a).selectList,b=>(M(),se(Y,{label:b.value,key:b.value},{default:m(()=>[E(j(b.text),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(I,{label:"预览图片上传",prop:"picImg"},{default:m(()=>[u(pe,{url:"/api/upload",accept:"image/*",modelValue:f(r).picImg,"onUpdate:modelValue":n[11]||(n[11]=b=>f(r).picImg=b),onSuccess:o,"before-upload":A,name:"image"},null,8,["modelValue"])]),_:1}),u(l,null,{default:m(()=>[u(N,{block:"",type:"primary",onClick:B},{icon:m(()=>[u(re,{icon:f(C)=="edit"?"mdi:circle-edit-outline":"ion:plus"},null,8,["icon"])]),default:m(()=>[E("确认"+j(f(C)=="edit"?"修改":"添加")+" ",1)]),_:1})]),_:1}),u(l,null,{default:m(()=>[f(C)=="edit"?(M(),se(N,{key:0,block:"",type:"warning",onClick:P},{icon:m(()=>[u(re,{icon:"ion:trash-outline"})]),default:m(()=>[E(" 删 除 ")]),_:1})):K("",!0)]),_:1})]),_:1},8,["model-value"])])]),_:1},8,["visible"])])}}});export{gt as default};
